/**
 * Script File of Film Society, HKUSTSU
 * Author: John Tan <johnmave126@gmail.com>
 * All Rights Reserved
 */

function assert(c,b){if(!c){var a="Assertion failed";if(b){a=a+": "+b}throw new Error(a)}}var global=this;function $(a){return document.getElementById(a)}function pad(c,a,b){b=b||"0";c=c+"";return c.length>=a?c:new Array(a-c.length+1).join(b)+c}function url(b){var a=b.replace(/(\(|\)|\,|\s|\'|\"|\\)/g,"\\$1");if(/\\\\$/.test(a)){a+=" "}return'url("'+a+'")'}function parseQueryParams(a){var f={};var c=unescape(a.search.substring(1));var d=c.split("&");for(var b=0;b<d.length;b++){var e=d[b].split("=");f[e[0]]=e[1]}return f}function findAncestorByClass(b,a){return findAncestor(b,function(c){if(c.classList){return c.classList.contains(a)}return null})}function findAncestor(c,a){var b=false;while(c!=null&&!(b=a(c))){c=c.parentNode}return b?c:null}function swapDomNodes(d,c){var f=d.nextSibling;if(f==c){swapDomNodes(c,d);return}var e=d.parentNode;c.parentNode.replaceChild(d,c);e.insertBefore(c,f)}function disableTextSelectAndDrag(b,a){document.onselectstart=function(c){if(!(b&&b.call(this,c))){c.preventDefault()}};document.ondragstart=function(c){if(!(a&&a.call(this,c))){c.preventDefault()}}}function preventDefaultOnPoundLinkClicks(){document.addEventListener("click",function(b){var a=findAncestor(b.target,function(c){return c.tagName=="A"});if(a&&a.getAttribute("href")=="#"){b.preventDefault()}})}function getRequiredElement(b){var a=$(b);assert(a,"Missing required element: "+b);return a}(function(){if(!Element.prototype.matches){if(Element.prototype.webkitMatchesSelector){Element.prototype.matches=Element.prototype.webkitMatchesSelector}else{if(Element.prototype.mozMatchesSelector){Element.prototype.matches=Element.prototype.mozMatchesSelector}else{if(Element.prototype.oMatchesSelector){Element.prototype.matches=Element.prototype.oMatchesSelector}else{if(Element.prototype.msMatchesSelector){Element.prototype.matches=Element.prototype.msMatchesSelector}}}}}assert(Element.prototype.matches,"Unsupported Browser")})();function createElementWithClassName(b,a){var c=document.createElement(b);c.className=a;return c}function extend(c,a){var b=function(){};b.prototype=a.prototype;c.prototype=new b();c.prototype.constructor=c;c.prototype.extend=function(d){assert(this.hasOwnProperty("extend"),"Only prototype callable");for(var e in d){if(d.hasOwnProperty(e)){this[e]=d[e]}}};c.uber=a.prototype}function superCall(a,b){assert(a.uber,"Not a subclass of any class");assert(a.uber[b] instanceof Function,"super class has no functin specified");return a.uber[b].bind(a)}function deepCopy(d){if(d==null||typeof(d)!=="object"){return d}if(typeof d.clone=="function"){return d.clone(true)}if(d instanceof Date){return new Date(d.getTime())}if(d instanceof RegExp){return new RegExp(d)}if(d.nodeType&&typeof d.cloneNode=="function"){return d.cloneNode(true)}if(d instanceof Array){return d.slice(0)}var c=(Object.getPrototypeOf?Object.getPrototypeOf(d):d.__proto__);if(!c){c=d.constructor.prototype}var a=Object.create(c);for(var b in d){a[b]=deepCopy(d[b])}return a}(function(){if(!Function.prototype.bind){Function.prototype.bind=function(a){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var e=Array.prototype.slice.call(arguments,1),d=this,b=function(){},c=function(){return d.apply(this instanceof b&&a?this:a,e.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;c.prototype=new b();return c}}})();var EventTracker=(function(){function a(){this.listeners_=[]}a.Entry;a.prototype={add:function(e,c,f,b){var d={node:e,eventType:c,listener:f,capture:b};this.listeners_.push(d);e.addEventListener(c,f,b)},remove:function(c,b){this.listeners_=this.listeners_.filter(function(d){if(d.node==c&&(!b||(d.eventType==b))){a.removeEventListener_(d);return false}return true})},removeAll:function(){this.listeners_.forEach(a.removeEventListener_);this.listeners_=[]}};a.removeEventListener_=function(b){b.node.removeEventListener(b.eventType,b.listener,b.capture)};return a})();var global=this;this.cr=(function(){function n(r,p,u){var s=r.split(".");var t=u||global;for(var q;s.length&&(q=s.shift());){if(!s.length&&p!==undefined){t[q]=p}else{if(q in t){t=t[q]}else{t=t[q]={}}}}return t}function g(t,p,s,q){var r=new cr.Event(p+"Change");r.propertyName=p;r.newValue=s;r.oldValue=q;t.dispatchEvent(r)}function c(p){return p.replace(/([A-Z])/g,"-$1").toLowerCase()}var j={JS:"js",ATTR:"attr",BOOL_ATTR:"boolAttr"};function e(q,s){switch(s){case j.JS:var r=q+"_";return function(){return this[r]};case j.ATTR:var p=c(q);return function(){return this.getAttribute(p)};case j.BOOL_ATTR:var p=c(q);return function(){return this.hasAttribute(p)}}}function o(q,s,t){switch(s){case j.JS:var r=q+"_";return function(v){var u=this[q];if(v!==u){this[r]=v;if(t){t.call(this,v,u)}g(this,q,v,u)}};case j.ATTR:var p=c(q);return function(v){var u=this[q];if(v!==u){if(v==undefined){this.removeAttribute(p)}else{this.setAttribute(p,v)}if(t){t.call(this,v,u)}g(this,q,v,u)}};case j.BOOL_ATTR:var p=c(q);return function(v){var u=this[q];if(v!==u){if(v){this.setAttribute(p,q)}else{this.removeAttribute(p)}if(t){t.call(this,v,u)}g(this,q,v,u)}}}}function d(s,p,t,r){if(typeof s=="function"){s=s.prototype}var q=t||j.JS;if(!s.__lookupGetter__(p)){s.__defineGetter__(p,e(p,q))}if(!s.__lookupSetter__(p)){s.__defineSetter__(p,o(p,q,r))}}var f=1;function a(){return f++}function b(p){if(p.hasOwnProperty("uid")){return p.uid}return p.uid=a()}function i(t,r,q,p){var s=new cr.Event(r,q,p);return t.dispatchEvent(s)}function k(t,p){var u=n(t);var r=p();for(var q in r){var s=Object.getOwnPropertyDescriptor(r,q);if(s){Object.defineProperty(u,q,s)}}}function l(p){p.getInstance=function(){return p.instance_||(p.instance_=new p())}}function m(r,q,p){var s=cr.doc.createEvent("Event");s.initEvent(r,!!q,!!p);s.__proto__=global.Event.prototype;return s}function h(){if(!global.document){var p=cr;Object.defineProperty(global,"cr",{get:function(){Object.defineProperty(global,"cr",{value:p});p.initialize();return p},configurable:true});return}m.prototype={__proto__:global.Event.prototype};cr.doc=document}return{addSingletonGetter:l,createUid:a,define:k,defineProperty:d,dispatchPropertyChange:g,dispatchSimpleEvent:i,Event:m,getUid:b,initialize:h,PropertyKind:j}})();cr.initialize();cr.define("cr",function(){function a(){}a.prototype={addEventListener:function(d,c){if(!this.listeners_){this.listeners_=Object.create(null)}if(!(d in this.listeners_)){this.listeners_[d]=[c]}else{var b=this.listeners_[d];if(b.indexOf(c)<0){b.push(c)}}},removeEventListener:function(e,d){if(!this.listeners_){return}if(e in this.listeners_){var b=this.listeners_[e];var c=b.indexOf(d);if(c>=0){if(b.length==1){delete this.listeners_[e]}else{b.splice(c,1)}}}},dispatchEvent:function(g){if(this["on"+g.type]){return this["on"+g.type].call(this,g)}if(!this.listeners_){return true}var c=this;g.__defineGetter__("target",function(){return c});g.preventDefault=function(){this.returnValue=false};var f=g.type;var h=0;if(f in this.listeners_){var b=this.listeners_[f].concat();for(var d=0,e;e=b[d];d++){if(e.handleEvent){h|=e.handleEvent.call(e,g)===false}else{h|=e.call(this,g)===false}}}return !h&&g.returnValue}};return{EventTarget:a}});cr.define("cr.settings",function(){return{resource_base:"http://ihome.ust.hk/~su_film/asset/",api_base:"http://dma080.resnet.ust.hk:49000/film/api/",login_url:"http://dma080.resnet.ust.hk:49000/film/member/login/",logout_url:"http://dma080.resnet.ust.hk:49000/film/member/logout/"}});cr.define("cr.ui.template",function(){var templates={},BBHandler=[{pattern:/\[b\](.*?)\[\/b\]/ig,repl:"<b>$1</b>"},{pattern:/\[i\](.*?)\[\/i\]/ig,repl:"<em>$1</em>"},{pattern:/\[u\](.*?)\[\/u\]/ig,repl:"<u>$1</u>"},{pattern:/\[big\](.*?)\[\/big\]/ig,repl:"<big>$1</big>"},{pattern:/\[small\](.*?)\[\/small\]/ig,repl:"<small>$1</small>"},{pattern:/\[color=([a-zA-Z]*|\#?[0-9a-fA-F]{6})\](.*?)\[\/color\]/ig,repl:'<span style="color:$1">$2</span>'},{pattern:/\[link\=\s*((?:(?:ftp|https?):\/\/)?(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,6}\.?|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+))\s*\](.+)\[\/link\]/ig,repl:'<a href="$1">$2</a>'},{pattern:/\[img\=\s*((?:(?:ftp|https?):\/\/)?(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,6}\.?|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+))\s*\](.+)\[\/img\]/ig,repl:'<img src="$1" alt="$2" title="$2">'}];function escapeWrap(value){return"<p>"+value.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;").replace("'","&#x27;").replace("/","&#x2F;").replace("\n","</p><p>")+"</p>"}function escapeAttr(value){return value.replace('"',"&quot;").replace("'","&#x27;")}function escapeHTML(value){return value.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;").replace("'","&#x27;").replace("/","&#x2F;").replace("\n"," ")}function escapeBBCode(value){value=escapeHTML(value);for(var i=0;i<BBHandler.length;i++){var dup_value;do{dup_value=value;value=value.replace(BBHandler[i].pattern,BBHandler[i].repl)}while(dup_value!=value)}return value}function render_template(url,param){var template=templates[url],wrapper=document.createElement("div"),item,text,func_head,func_bottom;if(template===undefined){throw new ReferenceError("Undefined template.")}param=param||{};text=template.content||"";var argn=[],args=[];for(var prop in param){if(param.hasOwnProperty(prop)&&/^[_a-zA-Z][_a-zA-Z0-9]*$/.test(prop)){argn.push(prop);args.push("param."+prop)}}func_head="(function("+argn.join(",")+"){ return eval('";func_bottom="');})("+args.join(",")+")";var html=text.replace(/{{(.*?)}}/g,function(m,value){var arg_list,escaper=escapeHTML;value=value.trim();arg_list=value.split("|");if(arg_list[1]){switch(arg_list[1].trim()){case"safe":escaper=function(value){return value};break;case"attr":escaper=escapeAttr;break;case"bbcode":escaper=escapeBBCode;break;case"wrap":escaper=escapeWrap;break;default:break}}var result=eval(func_head+arg_list[0].trim().replace(/'/g,"\\'")+func_bottom);if(result!=undefined){result=""+result}else{result=""}return escaper(result)});wrapper.innerHTML=html;item=wrapper.firstChild||document.createElement("div");if(template.callback){template.callback.call(item,param)}return item}function globalInitialization(){var pending=[],complete_cnt=0;for(var url in templates){var xhr=new XMLHttpRequest();xhr.open("GET",cr.settings.resource_base+"templates/"+url,true);xhr.onload=(function(url){templates[url].content=this.responseText.trim();complete_cnt++;if(complete_cnt==pending.length){cr.dispatchSimpleEvent(window,"moduleload",false,false)}}).bind(xhr,url);xhr.onerror=function(e){e.recObj={errno:xhr.status,error:""};cr.errorHandler(e)};pending.push(xhr)}for(var i=0;i<pending.length;i++){pending[i].send(null)}if(pending.length===0){cr.dispatchSimpleEvent(window,"moduleload",false,false)}}function register(url,callback){templates[url]={content:null,callback:callback}}function registerBBCode(pattern,repl){assert(pattern instanceof RegExp,"pattern must be RegExp");BBHandler.push({pattern:pattern,repl:repl})}return{globalInitialization:globalInitialization,render_template:render_template,register:register,registerBBCode:registerBBCode,escapeAttr:escapeAttr}});document.addEventListener("DOMContentLoaded",cr.ui.template.globalInitialization);cr.define("cr",function(){function a(c){Object.defineProperty(this,"name",{value:c});this._cache={};this.fields=[]}function b(c,g,d,f){var e=cr.settings.api_base+c.name+d;this.xhr=new XMLHttpRequest();if(g==="GET"&&f){this.xhr.open(g,e+((/\?/).test(e)?"&":"?")+(new Date()).getTime(),true)}else{this.xhr.open(g,e,true)}this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");this.xhr.withCredentials=true;this.xhr.onprogress=(function(h){if(this.onloadprogress){this.onloadprogress(h)}}).bind(this);this.xhr.upload.onprogress=(function(h){if(this.onuploadprogress){this.onuploadprogress(h)}}).bind(this);this.xhr.onreadystatechange=(function(){if(this.xhr.readyState===4){var j;if(this.xhr.status===200){try{var i=JSON.parse(this.xhr.responseText);this.success=i.errno===0;this.data=i;j=new cr.Event((i.errno===0)?"load":"error",false,true);j.recObj=i}catch(h){this.success=false;this.data={errno:2,error:"Error receiving data"};j=new cr.Event("error",false,true);j.recObj={errno:2,error:"Error receiving data"}}}else{this.success=false;this.data={errno:this.xhr.status,error:this.xhr.statusText};j=new cr.Event("error",false,true);j.recObj={errno:this.xhr.status,error:this.xhr.statusText}}this.dispatchEvent(j)}}).bind(this)}extend(b,cr.EventTarget);b.prototype.extend({onload:null,onerror:null,onuploadprogress:null,onloadprogress:null,send:function(){this.xhr.send()},sendRaw:function(c){this.xhr.send(c)},sendForm:function(c){this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.xhr.send(c)},sendJSON:function(c){this.xhr.setRequestHeader("Content-Type","application/json");this.xhr.send(JSON.stringify(c))}});a.prototype={update:function(d,e){if(!this._cache[d.id]){this._cache[d.id]={data:{}}}for(var c in d){if(this.fields.indexOf(c)!==-1){this._cache[d.id].data[c]=d[c]}}this._cache[d.id].dirty=e},get:function(e,d){if(this._cache[e]&&this._cache[e].dirty>0){if(d){d(deepCopy(this._cache[e].data))}}else{var c=new b(this,"GET","/"+e+"/",this._cache[e]);c.onload=(function(f){this.update(f.recObj,1);if(d){d(deepCopy(this._cache[e].data))}}).bind(this);c.onerror=function(f){cr.errorHandler(f)};c.send()}},put:function(g,d,f,e){var c=new b(this,"PUT","/"+g+"/");c.onload=(function(h){if(f){this.update(h.recObj,2)}if(e){e(deepCopy(this._cache[g].data))}}).bind(this);c.onerror=function(h){cr.errorHandler(h)};c.sendJSON(d)},post:function(d,e){var c=new b(this,"POST","/");c.onload=(function(f){this.update(f.recObj,2);if(e){e(deepCopy(this._cache[f.recObj.id].data))}}).bind(this);c.onerror=function(f){cr.errorHandler(f)};c.sendJSON(d)},remove:function(e,d){var c=new b(this,"DELETE","/"+e+"/");c.onload=(function(f){if(this._cache[f.recObj.id]){delete this._cache[f.recObj.id]}if(d){d(f.recObj)}}).bind(this);c.onerror=function(f){cr.errorHandler(f)};c.send()},setup:function(e){if(e){var c=6*60*1000;var d=(function(){var f=new b(this,"GET","/dirty/",true);f.onerror=function(g){if(g.recObj.errno!==403){setTimeout(d,c)}};f.onload=(function(h){for(var g=0;g<h.recObj.dirty.length;g++){if(this._cache[h.recObj.dirty[g]]){this._cache[h.recObj.dirty[g]].dirty--}}}).bind(this);f.send()}).bind(this);setTimeout(d,c)}}};return{BaseModel:a,APIRequest:b}});cr.define("cr",function(){function c(d,e){Object.defineProperty(this,"model",{value:d});Object.defineProperty(this,"has_prev",{get:function(){return this._cache[this.pos].meta.previous.length>0}});Object.defineProperty(this,"has_next",{get:function(){return this._cache[this.pos].meta.next.length>0}});Object.defineProperty(this,"page",{get:function(){return this._cache[this.pos].meta.page}});Object.defineProperty(this,"total",{get:function(){return this._cache[this.pos].meta.total}});Object.defineProperty(this,"obj_list",{get:function(){return this._cache[this.pos].objects}});this._cache={};this.pos=0;(a.bind(this))(e,0)}function b(f,h){var g=[],d=0;for(var e=0;e<f.objects.length;e++){this.model.get(f.objects[e],(function(j,i){g[j]=i;d++;if(d===f.objects.length){if(h){h.call(this,g)}}}).bind(this,e))}}function a(e,g,f){if(this._cache[g]){if(this._cache[g].state===1){(b.bind(this))(this._cache[g],f)}else{this._cache[g].callback=f}}else{if(!e){return}this._cache[g]={state:0,callback:f,objects:[],meta:{}};var d=new cr.APIRequest(this.model,"GET",e);d.onload=(function(k){var j=this._cache[g],l=k.recObj;j.meta=deepCopy(l.meta);for(var h=0;h<l.objects.length;h++){this.model.update(l.objects[h],1);j.objects.push(l.objects[h].id)}j.state=1;if(j.callback){j.callback.call(this,l.objects)}}).bind(this);d.onerror=cr.errorHandler;d.send()}}c.prototype={load:function(d){(a.bind(this))(null,this.pos,function(){if(d){d.apply(this,arguments)}if(!this._cache[this.pos+1]){(a.bind(this))(this._cache[this.pos].meta.next,this.pos+1,null)}if(!this._cache[this.pos-1]){(a.bind(this))(this._cache[this.pos].meta.previous,this.pos-1,null)}})},next:function(d){if(this._cache[this.pos].meta.next){this.pos++}(a.bind(this))(null,this.pos,function(){if(d){d.apply(this,arguments)}if(!this._cache[this.pos+1]){(a.bind(this))(this._cache[this.pos].meta.next,this.pos+1,null)}})},prev:function(d){if(this._cache[this.pos].meta.previous){this.pos--}(a.bind(this))(null,this.pos,function(){if(d){d.apply(this,arguments)}if(!this._cache[this.pos-1]){(a.bind(this))(this._cache[this.pos].meta.previous,this.pos-1,null)}})}};return{Pager:c}});cr.define("routerManager",function(){function c(){return location.hash.substr(1)}function f(k){var n={};var l=k.split("&");for(var j=0;j<l.length;j++){var m=l[j].split("=");n[m[0]]=decodeURIComponent(m[1])}return n}function e(){var o=c(),n;var m=o.indexOf("?");if(m===-1){n={}}else{n=o.slice(m+1,o.length);n=f(n);o=o.slice(0,m)}if(o.length===0){this.pushState(this.defaultRouter.url,true);this.defaultRouter.callback.apply(this.defaultRouter,k);return}if(o[o.length-1]!=="/"){o=o+"/"}for(var l=0;l<this.routers.length;l++){var j=this.routers[l];if(j.re.test(o)){var k;o.replace(j.re,function(){var p=Array.prototype.indexOf.call(arguments,0);k=Array.prototype.slice.call(arguments,1,p);for(var q=0;q<k.length;q++){k[q]=a(k[q])}});k.push(n);j.callback.apply(j,k);return}}cr.notFoundHandler(o)}function b(){window.addEventListener("authload",(function(){window.onpopstate=e.bind(this);this.parseHash()}).bind(this));this.routers=[];this.notFoundHandler=function(){};this.defaultRouter={url:"",callback:function(){},re:new RegExp("")}}function d(i){return i.replace("!","!0").replace("/","!1")}function a(i){return i.replace("!1","/").replace("!0","!")}function h(j,k,l){if(j===c()){return}var i=!k?window.history.pushState:window.history.replaceState;i.call(window.history,{},"","#"+j);if(!l){this.parseHash()}}function g(k,j,l){assert(k instanceof RegExp,"Regular Expression wanted");var i={url:k.source.replace("\\/","/"),callback:l,re:new RegExp("^"+k.source+"$")};this.routers.push(i);if(j===true){this.defaultRouter=i}}return{globalInitialization:b,encodeComponent:d,decodeComponent:a,pushState:h,register:g,parseHash:e}});routerManager.globalInitialization();cr.define("cr.ui",function(){function b(l,j){var k;if(typeof l=="string"){k=cr.doc.querySelectorAll(l)}else{k=[l]}for(var g=0,h;h=k[g];g++){if(!(h instanceof j)){j.decorate(h)}}}function a(g,h){var i;if(h&&h.ownerDocument){i=h.ownerDocument}else{i=cr.doc}return i.createElement(g)}function f(h){var g,i;if(typeof h=="function"){g=h;i=""}else{g=a;i=h}function j(l){var m=g(i,l);j.decorate(m);for(var k in l){m[k]=l[k]}return m}j.decorate=function(k){k.__proto__=j.prototype;k.decorate()};return j}function e(g,n,m,i){g.style.width="10px";var t=g.ownerDocument;var o=t.defaultView;var q=o.getComputedStyle(g);var l=o.getComputedStyle(n);var s=q.direction=="rtl";var j=g.getBoundingClientRect();var u=n.getBoundingClientRect();var p=s?u.right-j.right:j.left-u.left;var v=parseInt(q.borderLeftWidth,10)+parseInt(q.paddingLeft,10)+parseInt(q.paddingRight,10)+parseInt(q.borderRightWidth,10);var h=s?parseInt(l.paddingLeft,10):parseInt(l.paddingRight,10);var r=n.clientWidth-p-v-h;if(i){r*=i}function k(){if(g.scrollWidth>r){g.style.width=r+"px"}else{g.style.width=0;var w=g.scrollWidth;if(w<m){g.style.width=m+"px"}else{g.style.width=w+"px"}}}g.addEventListener("input",k);k()}function d(g){if(!window.isFinite(g)){console.error("Pixel value is not a number: "+g)}return Math.round(g)+"px"}function c(k){var j=k.target.ownerDocument;var g=Math.min(1,k.detail);function i(l){l.stopPropagation();l.preventDefault()}function h(l){if(l.detail>g){g=l.detail;i(l)}else{j.removeEventListener("dblclick",i,true);j.removeEventListener("click",h,true)}}setTimeout(function(){j.addEventListener("click",h,true);j.addEventListener("dblclick",i,true)},0)}return{decorate:b,define:f,limitInputWidth:e,toCssPx:d,swallowDoubleClick:c}});(function(){if("ontouchstart" in document.documentElement){document.addEventListener("touchstart",function(n){var j=document.body.querySelectorAll(".hover");for(var k=0;k<j.length;k++){j[k].classList.remove("hover")}findAncestor(n.target,function(e){if(e.classList){e.classList.add("hover")}return !e.classList})},true);try{var g=/:hover/;for(var d=0;d<document.styleSheets.length;d++){var h=document.styleSheets[d];for(var c=0;h.cssRules&&c<h.cssRules.length;c++){var l=h.cssRules[c];if(l.type===CSSRule.STYLE_RULE&&g.test(l.selectorText)){var m=l.selectorText.split(","),a=[];for(var b=0;b<m.length;b++){if(!g.test(m[b])){a.push(m[b])}}if(a.length===0){h.deleteRule(c)}else{l.selectorText=a.join(",")}}}}}catch(f){}}})();cr.define("cr.ui",function(){var a=null;function b(k,h,e){var c=$("notification");var d=c.querySelector(".link-color");var f=e||5000;function j(){window.clearTimeout(a);c.classList.add("show");document.body.classList.add("notification-shown")}function i(){window.clearTimeout(a);c.classList.remove("show");document.body.classList.remove("notification-shown");d.tabIndex=-1;d.blur()}function g(){a=window.setTimeout(i,f)}c.firstElementChild.textContent=k;d.textContent=h;d.onclick=i;d.onkeydown=function(l){if(l.keyIdentifier=="Enter"){i()}};c.onmouseover=j;c.onmouseout=g;d.onfocus=j;d.onblur=g;d.tabIndex=0;j();g()}return{showNotification:b}});cr.define("cr.ui",function(){var a={TOP_START:"top-start",TOP_END:"top-end",BOTTOM_START:"bottom-start",BOTTOM_END:"bottom-end"};var b={ARROW_TO_MID_ANCHOR:"arrow-to-mid-anchor",BUBBLE_EDGE_TO_ANCHOR_EDGE:"bubble-edge-anchor-edge",ENTIRELY_VISIBLE:"entirely-visible"};var c=cr.ui.define("div");c.ARROW_OFFSET=30;c.MIN_VIEWPORT_EDGE_MARGIN=2;c.prototype={__proto__:HTMLDivElement.prototype,decorate:function(){this.className="bubble";this.innerHTML='<div class="bubble-content"></div><div class="bubble-shadow"></div><div class="bubble-arrow"></div>';this.hidden=true;this.bubbleAlignment=b.ENTIRELY_VISIBLE},set anchorNode(f){if(!this.hidden){return}this.anchorNode_=f},set content(f){if(!this.hidden){return}var g=this.querySelector(".bubble-content");g.innerHTML="";g.appendChild(f)},set arrowLocation(f){if(!this.hidden){return}this.arrowAtRight_=f==a.TOP_END||f==a.BOTTOM_END;if(document.documentElement.dir=="rtl"){this.arrowAtRight_=!this.arrowAtRight_}this.arrowAtTop_=f==a.TOP_START||f==a.TOP_END},set bubbleAlignment(f){if(!this.hidden){return}this.bubbleAlignment_=f},reposition:function(){var p=document.documentElement.clientWidth;var r=document.documentElement.clientHeight;var k=this.anchorNode_.getBoundingClientRect();var h=(k.left+k.right)/2;var m=this.getBoundingClientRect();var o=this.querySelector(".bubble-arrow").getBoundingClientRect();if(this.bubbleAlignment_==b.ENTIRELY_VISIBLE){var i=this.arrowAtRight_?h+c.ARROW_OFFSET-m.width:h-c.ARROW_OFFSET;var f=p-m.width-c.MIN_VIEWPORT_EDGE_MARGIN;var q=c.MIN_VIEWPORT_EDGE_MARGIN;if(document.documentElement.dir=="rtl"){i=Math.min(Math.max(i,q),f)}else{i=Math.max(Math.min(i,f),q)}var l=Math.min(Math.max(o.width/2,this.arrowAtRight_?i+m.width-h:h-i),m.width-o.width/2);var g=Math.min(r-k.bottom-m.height,o.height/2);var j=Math.min(k.top-m.height,o.height/2);if(g<0&&j<0){var n=0;this.updateArrowPosition_(false,false,l)}else{if(g>j||g==j&&this.arrowAtTop_){var n=k.bottom+g;this.updateArrowPosition_(true,true,l)}else{var n=k.top-m.height-j;this.updateArrowPosition_(true,false,l)}}}else{if(this.bubbleAlignment_==b.BUBBLE_EDGE_TO_ANCHOR_EDGE){var i=this.arrowAtRight_?k.right-m.width:k.left}else{var i=this.arrowAtRight_?h-this.clientWidth+c.ARROW_OFFSET:h-c.ARROW_OFFSET}var n=this.arrowAtTop_?k.bottom+o.height/2:k.top-this.clientHeight-o.height/2;this.updateArrowPosition_(true,this.arrowAtTop_,c.ARROW_OFFSET)}this.style.left=i+"px";this.style.top=n+"px"},show:function(){if(!this.hidden){return}this.attachToDOM_();this.hidden=false;this.reposition();var f=this.ownerDocument;this.eventTracker_=new EventTracker;this.eventTracker_.add(f,"keydown",this.handleEvent.bind(this),true);this.eventTracker_.add(f,"mousedown",this.handleEvent.bind(this),true)},hide:function(){if(this.hidden){return}this.eventTracker_.removeAll();this.hidden=true;this.parentNode.removeChild(this)},handleEvent:function(f){if(f.type=="keydown"&&f.keyCode==27){this.hide();f.preventDefault();f.stopPropagation()}},attachToDOM_:function(){document.body.appendChild(this)},updateArrowPosition_:function(j,h,g){var i=this.querySelector(".bubble-arrow");i.hidden=!j;if(!j){return}var f=(-i.clientHeight/2)+"px";i.style.top=h?f:"auto";i.style.bottom=h?"auto":f;f=(g-i.offsetWidth/2)+"px";i.style.left=this.arrowAtRight_?"auto":f;i.style.right=this.arrowAtRight_?f:"auto"}};var e=cr.ui.define("div");e.prototype={__proto__:c.prototype,decorate:function(){c.prototype.decorate.call(this);var f=document.createElement("div");f.className="bubble-close";this.insertBefore(f,this.querySelector(".bubble-content"));this.handleCloseEvent=this.hide;this.deactivateToDismissDelay_=0;this.bubbleAlignment=b.ARROW_TO_MID_ANCHOR},set handleCloseEvent(f){if(!this.hidden){return}this.handleCloseEvent_=f},set deactivateToDismissDelay(f){this.deactivateToDismissDelay_=f},set closeButtonVisible(f){this.querySelector(".bubble-close").hidden=!f},show:function(){if(!this.hidden){return}c.prototype.show.call(this);this.showTime_=Date.now();this.eventTracker_.add(window,"resize",this.reposition.bind(this))},handleEvent:function(f){c.prototype.handleEvent.call(this,f);if(f.type=="mousedown"){if(f.target==this.querySelector(".bubble-close")){this.handleCloseEvent_()}else{if(!this.contains(f.target)&&Date.now()-this.showTime_>=this.deactivateToDismissDelay_){this.hide()}}}}};var d=cr.ui.define("div");d.prototype={__proto__:c.prototype,decorate:function(){c.prototype.decorate.call(this);this.classList.add("auto-close-bubble")},set domSibling(f){if(!this.hidden){return}this.domSibling_=f},show:function(){if(!this.hidden){return}c.prototype.show.call(this);this.domSibling_.showingBubble=true;var f=this.ownerDocument;this.eventTracker_.add(f,"mousewheel",this.handleEvent.bind(this),true);this.eventTracker_.add(f,"scroll",this.handleEvent.bind(this),true);this.eventTracker_.add(f,"elementFocused",this.handleEvent.bind(this),true);this.eventTracker_.add(window,"resize",this.handleEvent.bind(this))},hide:function(){c.prototype.hide.call(this);this.domSibling_.showingBubble=false},handleEvent:function(f){c.prototype.handleEvent.call(this,f);switch(f.type){case"mousedown":if(f.button==0&&this.anchorNode_.contains(f.target)){break}case"mousewheel":case"scroll":if(this.contains(f.target)){break}case"resize":this.hide();break;case"elementFocused":if(!this.anchorNode_.contains(f.target)&&!this.contains(f.target)){this.hide()}break}},attachToDOM_:function(){var f=this.domSibling_.parentNode;f.insertBefore(this,this.domSibling_.nextSibling)}};return{ArrowLocation:a,BubbleAlignment:b,BubbleBase:c,Bubble:e,AutoCloseBubble:d}});cr.define("cr.ui.overlay",function(){function e(){var i=document.querySelectorAll(".overlay:not([hidden])");return i[i.length-1]}function h(j){function m(i){return i.hidden}var l=j.querySelectorAll(".page .button-strip > .default-button");for(var k=0;k<l.length;k++){if(!findAncestor(l[k],m)){return l[k]}}return null}function a(){document.addEventListener("keydown",function(l){var j=e();if(!j){return}if(l.keyCode==27){cr.dispatchSimpleEvent(j,"cancelOverlay")}var i=/^(A|BUTTON|SELECT|TEXTAREA)$/;if(l.keyIdentifier=="Enter"&&!i.test(document.activeElement.tagName)){var k=h(j);if(k){k.click()}}});window.addEventListener("resize",d);d()}function d(){var j=document.querySelectorAll(".overlay .page");var l=Math.min(0.9*window.innerHeight,640)+"px";for(var k=0;k<j.length;k++){j[k].style.maxHeight=l}}function c(k){var m=k.querySelectorAll(".page > .close-button");for(var l=0;l<m.length;l++){m[l].addEventListener("click",function(i){cr.dispatchSimpleEvent(k,"cancelOverlay")})}k.addEventListener("cancelOverlay",g,true);var j=k.querySelectorAll(".page");for(var l=0;l<j.length;l++){j[l].__defineSetter__("hidden",function(i){if(i){this.setAttribute("hidden",true)}else{this.removeAttribute("hidden")}});j[l].__defineGetter__("hidden",function(){return this.hasAttribute("hidden")})}k.__defineSetter__("hidden",function(i){this.classList.remove("pulse");if(i){this.setAttribute("hidden",true)}else{this.removeAttribute("hidden")}});k.__defineGetter__("hidden",function(){return this.hasAttribute("hidden")});k.addEventListener("click",function(n){if(this!=n.target){return}var i=this.querySelector(".page:not([hidden])");if(i){i.classList.add("pulse")}});k.addEventListener("webkitAnimationEnd",function(i){i.target.classList.remove("pulse")});k.addEventListener("MSAnimationEnd",function(i){i.target.classList.remove("pulse")});k.addEventListener("oAnimationEnd",function(i){i.target.classList.remove("pulse")});k.addEventListener("animationend",function(i){i.target.classList.remove("pulse")})}function b(l){var k=l.querySelectorAll(".close-button");for(var j=0;j<k.length;j++){k[j].addEventListener("click",function(i){cr.dispatchSimpleEvent(l.parentNode,"cancelOverlay")})}l.__defineSetter__("hidden",function(i){if(i){this.setAttribute("hidden",true)}else{this.removeAttribute("hidden")}});l.__defineGetter__("hidden",function(){return this.hasAttribute("hidden")})}function f(k){assert(k);var i=k.parentNode,j=i.querySelector(".page:not([hidden])");if(j===k){return}if(j){j.hidden=true}i.hidden=false;i.classList.remove("transparent");k.hidden=false;k.classList.add("pulse");document.body.classList.add("hideflow")}function g(k){assert(k.target);var i=findAncestor(k.target,function(l){return l.classList.contains("overlay")});assert(i);var j=function(n){if(!n.target.classList.contains("overlay")){return}if(k.target.classList.contains("page")){k.target.hidden=true}else{var m=n.target.querySelectorAll(".page:not([hidden])");for(var l=0;l<m.length;l++){m[l].hidden=true}}if(!n.target.querySelector(".page:not([hidden])")){n.target.hidden=true;if(!document.body.querySelector(".overlay:not([hidden])")){document.body.classList.remove("hideflow")}}n.target.removeEventListener("webkitAnimationEnd",j);n.target.removeEventListener("MSAnimationEnd",j);n.target.removeEventListener("oAnimationEnd",j);n.target.removeEventListener("animationend",j)};i.addEventListener("webkitAnimationEnd",j,false);i.addEventListener("MSAnimationEnd",j,false);i.addEventListener("oAnimationEnd",j,false);i.addEventListener("animationend",j,false);i.classList.add("transparent")}return{globalInitialization:a,setupOverlay:c,setupPage:b,showOverlay:f,hideOverlay:g}});document.addEventListener("DOMContentLoaded",cr.ui.overlay.globalInitialization);cr.define("cr.ui",function(){function e(m){var l=$("main-container");l.classList.add("loading");if(m instanceof HTMLElement||m instanceof DocumentFragment){setTimeout(function(){l.setAttribute("hidden",true);while(l.firstChild){l.removeChild(l.firstChild)}l.appendChild(m);l.removeAttribute("hidden");l.classList.remove("loading")},180)}else{if(m instanceof Function){setTimeout(function(){l.setAttribute("hidden",true);while(l.firstChild){l.removeChild(l.firstChild)}m(l);l.removeAttribute("hidden");l.classList.remove("loading")},180)}else{l.classList.remove("loading");assert(false,"Error processing content")}}}function h(){var m=document.querySelectorAll("li:not(.space)");for(var l=0;l<m.length;++l){m[l].addEventListener("click",f)}}function f(m){if(m.currentTarget.classList.contains("space")){return}if(!m.currentTarget.classList.contains("selected")){j(m.currentTarget)}var l=m.currentTarget.getAttribute("controls");routerManager.pushState(l+"/",false,false)}function b(m){var l=document.querySelector('li[controls="'+m+'"]');j(l)}function j(l){var m=document.querySelector("li.selected");if(m!==l){l.classList.add("selected");if(m){m.classList.remove("selected")}}}function d(l){var m=l.querySelectorAll(".temp-loading"),n=createElementWithClassName("div","temp-loading");if(m.length>0){return}n.innerHTML='<div class="throbber"></div><span>Loading...</span>';l.setAttribute("hidden",true);l.appendChild(n);l.removeAttribute("hidden")}function g(m){var n=m.querySelectorAll(".temp-loading");m.setAttribute("hidden",true);for(var l=0;l<n.length;l++){m.removeChild(n[l])}m.removeAttribute("hidden")}function c(l){if(l.keyCode==27){l.preventDefault();l.stopImmediatePropagation();l.stopPropagation()}return false}function a(){cr.ui.overlay.showOverlay($("loadingOverlay"));window.addEventListener("keydown",c,true)}function k(){window.removeEventListener("keydown",c);cr.dispatchSimpleEvent($("loadingOverlay"),"cancelOverlay")}function i(){var l=$("multiuseOverlay");l.querySelector("h1").innerHTML="&nbsp;";l.querySelector(".content-area").innerHTML="";$("multiuse-button1").setAttribute("hidden","true");$("multiuse-button2").setAttribute("hidden","true");$("multiuse-button3").setAttribute("hidden","true");if(l.eventTracker){l.eventTracker.removeAll()}else{l.eventTracker=new EventTracker}}return{replaceContent:e,controlInitialization:h,changeSelection:b,displayLoading:d,removeLoading:g,showLoading:a,hideLoading:k,resetMultiuse:i}});document.addEventListener("DOMContentLoaded",cr.ui.controlInitialization);cr.define("alertOverlay",function(){var d;var c;function a(f){d=$("alertOverlayOk");c=$("alertOverlayCancel");d.addEventListener("click",function(g){assert(d.clickCallback);d.clickCallback(g);d.clickCallback=null;c.clickCallback=null});c.addEventListener("click",function(g){assert(c.clickCallback);c.clickCallback(g);d.clickCallback=null;c.clickCallback=null})}function b(j,g,f,i,h,e){if(typeof j!="undefined"){$("alertOverlayTitle").textContent=j}$("alertOverlayTitle").hidden=typeof j=="undefined";if(typeof g!="undefined"){$("alertOverlayMessage").textContent=g}$("alertOverlayMessage").hidden=typeof g=="undefined";if(f){d.textContent=f}d.hidden=!f;d.clickCallback=h;if(i){c.textContent=i}c.hidden=!i;c.clickCallback=e}return{initialize:a,setValues:b}});document.addEventListener("DOMContentLoaded",alertOverlay.initialize);cr.define("cr.ui",function(){function a(c,b){this.initialize(c,b)}a.prototype={initialize:function(c,b){c.addEventListener("dragenter",this.onDragEnter_.bind(this));c.addEventListener("dragover",this.onDragOver_.bind(this));c.addEventListener("drop",this.onDrop_.bind(this));c.addEventListener("dragleave",this.onDragLeave_.bind(this));this.target_=c;this.handler_=b},dragEnters_:0,get isCurrentDragTarget(){return this.target_.classList.contains("drag-target")},onDragEnter_:function(b){if(++this.dragEnters_==1){if(this.handler_.shouldAcceptDrag(b)){this.target_.classList.add("drag-target");this.handler_.doDragEnter(b)}}else{this.onDragOver_(b)}},onDragOver_:function(b){if(!this.target_.classList.contains("drag-target")){return}this.handler_.doDragOver(b)},onDrop_:function(b){this.dragEnters_=0;if(!this.target_.classList.contains("drag-target")){return}this.target_.classList.remove("drag-target");this.handler_.doDrop(b)},onDragLeave_:function(b){if(--this.dragEnters_>0){return}this.target_.classList.remove("drag-target");this.handler_.doDragLeave(b)}};return{DragWrapper:a}});cr.define("cr.uploader",function(){function a(d,e,i){var c=d.querySelector(".progressbar-track"),b=d.querySelector(".progressbar-bar"),g=d.querySelector(".progressbar-progress"),f=d.querySelector(".drag-notifier"),h=new cr.ui.DragWrapper(d,{doDragEnter:function(j){j.preventDefault();j.stopImmediatePropagation();j.stopPropagation();f.removeAttribute("hidden")},doDragOver:function(j){j.preventDefault();j.stopImmediatePropagation();j.stopPropagation();f.removeAttribute("hidden")},doDrop:function(l){l.preventDefault();l.stopImmediatePropagation();l.stopPropagation();f.setAttribute("hidden","true");if(l.dataTransfer.files&&l.dataTransfer.files[0]){var k=new cr.APIRequest(cr.model.File,"POST","/"),j=new FormData;j.append("file",l.dataTransfer.files[0]);b.style.width="0%";g.textContent="0%";c.removeAttribute("hidden");g.removeAttribute("hidden");k.onuploadprogress=function(n){var m=(n.loaded/n.total*80|0)+"%";b.style.width=m;g.textContent=m};k.onloadprogress=function(n){if(n.lengthComputable){var m=(80+(n.loaded/n.total*20|0))+"%";b.style.width=m;g.textContent=m}};k.onload=function(m){b.style.width="100%";g.textContent="Upload Complete";if(i){i(m.recObj)}};k.onerror=cr.errorHandler;if(e){e()}k.sendRaw(j)}},doDragLeave:function(j){j.preventDefault();j.stopImmediatePropagation();j.stopPropagation();f.setAttribute("hidden","true")},shouldAcceptDrag:function(j){return true}})}return{init:a}});cr.define("cr.model",function(){var j=new cr.BaseModel("file"),k=new cr.BaseModel("user"),f=new cr.BaseModel("log"),e=new cr.BaseModel("disk"),g=new cr.BaseModel("regularfilmshow"),m=new cr.BaseModel("previewshowticket"),n=new cr.BaseModel("diskreview"),a=new cr.BaseModel("news"),d=new cr.BaseModel("document"),b=new cr.BaseModel("publication"),c=new cr.BaseModel("sponsor"),l=new cr.BaseModel("exco"),i=new cr.BaseModel("sitesettings"),h=new cr.BaseModel("onesentence");j.fields=["id","name","url"];k.fields=["id","expire_at","expired","admin","full_name","itsc","join_at","member_type","mobile","pennalized","rfs_count","login_count","student_id","university_id"];k.types=["create","edit","delete"];f.fields=["id","model","Type","model_refer","user_affected","admin_involved","content","created_at"];e.fields=["id","director_en","director_ch","category","create_log","imdb_url","show_year","avail_type","actors","desc_en","tags","reserved_by","title_en","cover_url","hold_by","disk_type","due_at","borrow_cnt","length","desc_ch","title_ch"];e.types=["create","edit","delete","reserve","borrow","rate"];g.fields=["id","state","film_1","film_2","film_3","vote_cnt_1","vote_cnt_2","vote_cnt_3","create_log","participant_list"];m.fields=["id","state","title_en","title_ch","desc_en","desc_ch","director_en","director_ch","actors","cover_url","language","subtitle","venue","show_time","apply_deadline","length","quantity","remarks","successful_applicant","create_log"];n.fields=["id","poster","disk","content","create_log"];e.types=["create","delete"];a.fields=["id","title","content","create_log"];d.fields=["id","title","doc_url","create_log"];b.fields=["id","Type","title","cover_url","doc_url","create_log"];c.fields=["id","name","x","y","w","h","img_url","create_log"];l.fields=["id","name_en","name_ch","descript","position","email","hall_allocate","img_url"];i.fields=["id","key","value"];i._cache_dict={};i.loadSettings=function(p){var o=new cr.APIRequest(this,"GET","/",true);o.onload=function(r){for(var q=0;q<r.recObj.objects.length;q++){i.update(r.recObj.objects[q],1);i._cache_dict[r.recObj.objects[q].key]=r.recObj.objects[q].id}if(p){p()}};o.onerror=cr.errorHandler;o.send()};i.getField=function(o){if(!this._cache_dict[o]){return null}return this._cache[this._cache_dict[o]].data};h.fields=["id","content","create_log","film"];h.types=["create","edit","delete"];return{File:j,User:k,Log:f,Disk:e,RegularFilmShow:g,PreviewShowTicket:m,DiskReview:n,News:a,Document:d,Publication:b,Sponsor:c,Exco:l,SiteSettings:i,OneSentence:h}});cr.model.User.setup(true);cr.model.Disk.setup(true);cr.model.RegularFilmShow.setup(true);cr.model.PreviewShowTicket.setup(true);cr.model.News.setup(true);cr.model.Document.setup(true);cr.model.Publication.setup(true);cr.model.Sponsor.setup(true);cr.model.Exco.setup(true);cr.define("Application",function(){function d(){cr.ui.overlay.setupOverlay($("overlay_1"));cr.ui.overlay.setupOverlay($("overlay_2"));cr.ui.showLoading();window.addEventListener("moduleload",function(){var f=new cr.APIRequest(cr.model.User,"GET","/current_user/",true);f.onload=function(g){if(!g.recObj.admin){g.recObj={errno:2,error:"Admin Only"};a(g)}else{cr.model.User.update(g.recObj,1);cr.define("cr",function(){return{user_id:g.recObj.id}});cr.model.SiteSettings.loadSettings(function(){cr.dispatchSimpleEvent(window,"authload",false,false)})}};f.onerror=a;f.send()});window.addEventListener("authload",cr.ui.hideLoading);cr.define("cr",function(){return{errorHandler:a,notFoundHandler:e}})}function a(f){cr.ui.hideLoading();alertOverlay.setValues("Error",f.recObj.error||"Fatal: Server Error","Retry",null,function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay");routerManager.parseHash()},null);cr.ui.overlay.showOverlay($("alertOverlay"))}function c(){var f=new Image();f.onload=function(){cr.ui.replaceContent(cr.ui.template.render_template("admin/start_page.html"))};f.src="../asset/css/admin/title_img.png"}function e(f){var g=cr.ui.template.render_template("admin/notfound.html",{url:f});cr.ui.replaceContent(g)}function b(h){var f=h.querySelectorAll("input:enabled, select:enabled, textarea:enabled"),j={};for(var g=0;g<f.length;g++){j[f[g].name]=(f[g].type==="checkbox")?f[g].checked:f[g].value;if(j[f[g].name]==undefined||j[f[g].name]===""){j[f[g].name]=null;if(f[g].getAttribute("role")==="list"){j[f[g].name]=""}}}return j}return{initialization:d,startPage:c,collectForm:b}});document.addEventListener("DOMContentLoaded",Application.initialization);cr.ui.template.register("admin/notfound.html");cr.ui.template.register("admin/start_page.html");routerManager.register(/\//,true,Application.startPage);cr.define("cr.logger",function(){function b(){var d=$("log-view-list");$("close-log-view").addEventListener("click",function(){cr.dispatchSimpleEvent(this,"cancelOverlay")});window.addEventListener("resize",c);c()}function c(){var d=$("log-view-list");d.style.maxHeight=(0.5*Math.min(0.9*window.innerHeight,640))+"px"}function a(w,m,n){var h=m.model,q=m.id,p=m.user,v=$("log-view-page"),k=$("log-view-list"),g=$("log-view-options"),o=new cr.Pager(cr.model.Log,r()),f=true,u=0;k.innerHTML='<div class="spacer"></div><div class="list-loading"><div class="spinner"></div></div>';$("log-view-title").textContent=w;var j=k.querySelector(".list-loading"),l=k.querySelector(".spacer");g.innerHTML="";for(var s=0;n&&s<n.length;s++){var t=cr.ui.template.render_template("admin/filter_checker.html",{type:n[s]});t.addEventListener("change",function(i){var d=i.target.getAttribute("filter");if(i.target.checked){n.push(d)}else{n.splice(n.indexOf(d),1)}u++;k.innerHTML='<div class="spacer"></div><div class="list-loading"><div class="spinner"></div></div>';j=k.querySelector(".list-loading");l=k.querySelector(".spacer");o=new cr.Pager(cr.model.Log,r());f=true;o.load(e.bind(o,u))});g.appendChild(t)}cr.ui.overlay.showOverlay($("log-view-page"));o.load(e.bind(o,u));k.onscroll=function(x){x.stopImmediatePropagation();if(f||!o.has_next){return}var i=k.scrollTop,y=k.clientHeight,d=k.scrollHeight;if(i+y+5>d){f=true;o.next(e.bind(o,u))}};function e(z,y){if(z!==u){return}if(!this.has_next){k.removeChild(j)}for(var x=0;x<y.length;x++){var A=cr.ui.template.render_template("admin/log_item.html",{log:y[x]});k.insertBefore(A,l);setTimeout((function(){this.classList.remove("loading")}).bind(A),x*30)}f=false}function r(){var d=[];if(h){d.push("model="+encodeURIComponent(h))}if(q){d.push("model_refer="+encodeURIComponent(q))}if(p){d.push("user_affected="+encodeURIComponent(p))}if(n){d.push("Type__in="+encodeURIComponent(n.join(",")))}return"/?"+d.join("&")}}return{showLogger:a,initialize:b}});document.addEventListener("DOMContentLoaded",cr.logger.initialize);cr.ui.template.register("admin/filter_checker.html");cr.ui.template.register("admin/log_item.html");cr.define("cr.view.member",function(){var a="member";function e(){routerManager.register(/member\//,false,d(c));routerManager.register(/member\/search\//,false,d(b));cr.ui.template.register("admin/user_list.html");cr.ui.template.register("admin/user_search.html");cr.ui.template.register("admin/user_list_item.html",function(i){this.querySelector('button[control="edit"]').addEventListener("click",(function(j){g(j.id)}).bind(null,i.user));this.querySelector('button[control="viewlog"]').addEventListener("click",(function(j){cr.logger.showLogger("View Logs of member "+j.itsc,{user:j.id})}).bind(null,i.user));this.querySelector('button[control="delete"]').addEventListener("click",f.bind(null,i.user))});cr.ui.template.register("admin/user_edit.html",function(){this.querySelector('input[name="university_id"]').addEventListener("keydown",function(i){if(i.keyCode===13){i.preventDefault();i.stopImmediatePropagation()}},true)});cr.ui.template.register("admin/user_create.html",function(){this.querySelector('input[name="university_id"]').addEventListener("keydown",function(i){if(i.keyCode===13){i.preventDefault();i.stopImmediatePropagation()}},true)})}function d(i){return function(){cr.ui.changeSelection(a);document.title="Member | Film Society, HKUSTSU";i.apply(this,arguments)}}function h(){var i=$("multiuseOverlay"),n=i.querySelector("h1"),m=i.querySelector(".content-area"),k=$("multiuse-button2"),j=$("multiuse-button3");cr.ui.resetMultiuse();n.textContent="Create New Member";k.textContent="Create";k.removeAttribute("hidden");j.textContent="Cancel";j.removeAttribute("hidden");i.eventTracker.add(j,"click",function(){cr.dispatchSimpleEvent(i,"cancelOverlay")});cr.ui.overlay.showOverlay(i);var l=cr.ui.template.render_template("admin/user_create.html");m.appendChild(l);i.eventTracker.add(k,"click",function(){cr.ui.showLoading();var o=Application.collectForm(m);cr.model.User.post(o,function(){cr.ui.hideLoading();cr.dispatchSimpleEvent(i,"cancelOverlay");history.go();cr.ui.showNotification("Saved","dismiss")})})}function g(n){var i=$("multiuseOverlay"),m=i.querySelector("h1"),l=i.querySelector(".content-area"),k=$("multiuse-button2"),j=$("multiuse-button3");cr.ui.resetMultiuse();m.textContent="Edit Member Information";k.textContent="Save";k.removeAttribute("hidden");j.textContent="Cancel";j.removeAttribute("hidden");i.eventTracker.add(j,"click",function(){cr.dispatchSimpleEvent(i,"cancelOverlay")});cr.ui.overlay.showOverlay(i);cr.model.User.get(n,function(p){var o=cr.ui.template.render_template("admin/user_edit.html",{user:p});l.appendChild(o);i.eventTracker.add(k,"click",function(){cr.ui.showLoading();var q=Application.collectForm(l);cr.model.User.put(n,q,true,function(){cr.ui.hideLoading();cr.dispatchSimpleEvent(i,"cancelOverlay");history.go();cr.ui.showNotification("Saved","dismiss")})})})}function f(i){alertOverlay.setValues("Confirm Delete","Confirm delete member "+i.itsc+"?","Delete","Cancel",function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay");cr.ui.showLoading();cr.model.User.remove(i.id,function(){cr.ui.hideLoading();history.go();cr.ui.showNotification("Deleted","dismiss")})},function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay")});cr.ui.overlay.showOverlay($("alertOverlay"))}function c(t){var s=t.page||1,m=t.type_filter?t.type_filter.split(","):["Full","OneSem","OneYear","TwoYear","ThreeYear","Honour","Assoc"],l=cr.ui.template.render_template("admin/user_list.html",{filter:m});cr.ui.replaceContent(l);var j=l.querySelector("list"),r=l.querySelector(".content"),v=l.querySelector("footer"),q="/?page="+s+"&member_type__in="+m.join(","),k=new cr.Pager(cr.model.User,q);cr.ui.displayLoading(r);k.load(n);l.querySelector("#page-prev").addEventListener("click",function(i){s--;routerManager.pushState(u(),false,true);scrollTo(0,0);cr.ui.displayLoading(r);k.prev(n)});l.querySelector("#page-next").addEventListener("click",function(i){s++;routerManager.pushState(u(),false,true);scrollTo(0,0);cr.ui.displayLoading(r);k.next(n)});var p=l.querySelectorAll('header .controls input[type="checkbox"]');for(var o=0;o<p.length;o++){p[o].addEventListener("change",function(x){var i=x.target.getAttribute("filter");if(x.target.checked){m.push(i)}else{m.splice(m.indexOf(i),1)}s=1;q="/?page="+s+"&member_type__in="+m.join(","),k=new cr.Pager(cr.model.User,q);routerManager.pushState(u(),false,true);scrollTo(0,0);cr.ui.displayLoading(r);k.load(n)})}l.querySelector("#user-view-log").addEventListener("click",function(){cr.logger.showLogger("View Logs of module User",{model:"User"},cr.model.User.types)});l.querySelector("#user-create-member").addEventListener("click",h);var w=l.querySelector('header .corner input[type="search"]');w.addEventListener("keydown",function(x){if(x.keyCode===13){if(x.target.value===""){return}var i={q:x.target.value};routerManager.pushState("member/search/?q="+encodeURIComponent(x.target.value),false,false)}});function n(y){cr.ui.removeLoading(r);j.classList.add("content-loading");j.innerHTML="";for(var x=0;x<y.length;x++){var z=cr.ui.template.render_template("admin/user_list_item.html",{user:y[x]});j.appendChild(z)}if(this.has_prev){v.querySelector(".lefthub").removeAttribute("hidden")}else{v.querySelector(".lefthub").setAttribute("hidden","true")}if(this.has_next){v.querySelector(".righthub").removeAttribute("hidden")}else{v.querySelector(".righthub").setAttribute("hidden","true")}v.querySelector(".centerhub > span").textContent=this.page+"/"+this.total;setTimeout(function(){j.classList.remove("content-loading")},100)}function u(){return"member/?page="+s+"&type_filter="+m.join(",")}}function b(q){var p=q.page||1,k=q.q||"",l=cr.ui.template.render_template("admin/user_search.html",{query:k});cr.ui.replaceContent(l);var i=l.querySelector("list"),o=l.querySelector(".content"),s=l.querySelector("footer"),n="/search/?page="+p+"&query="+encodeURIComponent(k),j=new cr.Pager(cr.model.User,n);cr.ui.displayLoading(o);j.load(m);l.querySelector("#page-prev").addEventListener("click",function(u){p--;routerManager.pushState(r(),false,true);scrollTo(0,0);cr.ui.displayLoading(o);j.prev(m)});l.querySelector("#page-next").addEventListener("click",function(u){p++;routerManager.pushState(r(),false,true);scrollTo(0,0);cr.ui.displayLoading(o);j.next(m)});l.querySelector("#user-view-log").addEventListener("click",function(){cr.logger.showLogger("View Logs of module User",{model:"User"},cr.model.User.types)});l.querySelector("#user-create-member").addEventListener("click",h);var t=l.querySelector('header .corner input[type="search"]');t.addEventListener("keydown",function(u){if(u.keyCode===13){if(u.target.value===""){return}k=u.target.value;p=1;n="/search/?page="+p+"&query="+encodeURIComponent(k);j=new cr.Pager(cr.model.User,n);routerManager.pushState(r(),false,true);scrollTo(0,0);cr.ui.displayLoading(o);j.load(m)}});function m(v){cr.ui.removeLoading(o);i.classList.add("content-loading");i.innerHTML="";for(var u=0;u<v.length;u++){var w=cr.ui.template.render_template("admin/user_list_item.html",{user:v[u]});i.appendChild(w)}if(this.has_prev){s.querySelector(".lefthub").removeAttribute("hidden")}else{s.querySelector(".lefthub").setAttribute("hidden","true")}if(this.has_next){s.querySelector(".righthub").removeAttribute("hidden")}else{s.querySelector(".righthub").setAttribute("hidden","true")}s.querySelector(".centerhub > span").textContent=this.page+"/"+this.total;setTimeout(function(){i.classList.remove("content-loading")},100)}function r(){return"member/search/?page="+p+"&q="+encodeURIComponent(k)}}return{Initialize:e}});cr.view.member.Initialize();cr.define("cr.view.liba",function(){var a="liba";function j(m){return m.disk_type+pad(m.id,4)}function f(){routerManager.register(/liba\//,false,d(c));routerManager.register(/liba\/search\//,false,d(h));cr.ui.template.register("admin/liba_list.html");cr.ui.template.register("admin/liba_search.html");cr.ui.template.register("admin/disk_list_item.html",function(n){var m=this.querySelector("div.cover-column > img");if(n.disk.cover_url){m.style.backgroundImage="url("+cr.settings.resource_base+"upload/"+n.disk.cover_url.url+")"}else{m.style.backgroundImage="url("+cr.settings.resource_base+"css/question.png)"}this.querySelector('button[control="edit"]').addEventListener("click",(function(o){e(o.id)}).bind(null,n.disk));this.querySelector('button[control="viewlog"]').addEventListener("click",(function(o){cr.logger.showLogger("View Logs of Disk "+j(o),{model:"Disk",id:o.id},cr.model.Disk.types)}).bind(null,n.disk));this.querySelector('button[control="checkout"]').addEventListener("click",g.bind(null,n.disk));this.querySelector('button[control="checkin"]').addEventListener("click",b.bind(null,n.disk));this.querySelector('button[control="renew"]').addEventListener("click",l.bind(null,n.disk));this.querySelector('button[control="delete"]').addEventListener("click",i.bind(null,n.disk))});cr.ui.template.register("admin/disk_edit.html",function(n){var m=this.querySelector(".cover-container");if(n.disk.cover_url){m.style.backgroundImage="url("+cr.settings.resource_base+"upload/"+n.disk.cover_url.url+")"}else{m.style.backgroundImage="url("+cr.settings.resource_base+"css/question.png)"}cr.uploader.init(this.querySelector(".cover-drop"),(function(){this.querySelector('input[name="cover_url"]').value="uploading"}).bind(this),(function(o){m.style.backgroundImage="url("+cr.settings.resource_base+"upload/"+o.url+")";this.querySelector('input[name="cover_url"]').value=o.id}).bind(this))});cr.ui.template.register("admin/disk_create.html",function(){var m=this.querySelector(".cover-container");m.style.backgroundImage="url("+cr.settings.resource_base+"css/question.png)";cr.uploader.init(this.querySelector(".cover-drop"),(function(){this.querySelector('input[name="cover_url"]').value="uploading"}).bind(this),(function(n){m.style.backgroundImage="url("+cr.settings.resource_base+"upload/"+n.url+")";this.querySelector('input[name="cover_url"]').value=n.id}).bind(this))});cr.ui.template.register("admin/disk_checkout.html",function(n){var m=this;this.querySelector('input[name="student_id"]').addEventListener("change",function(){m.querySelector('input[name="id"]').value="relate"});this.querySelector('input[name="university_id"]').addEventListener("keydown",function(p){if(p.keyCode===13){p.preventDefault();p.stopImmediatePropagation();p.stopPropagation();cr.ui.showLoading();var o=new cr.APIRequest(cr.model.User,"GET","/?university_id="+this.value,true);o.onload=function(q){cr.ui.hideLoading();if(q.recObj.objects.length===0){m.querySelector('input[name="student_id"]').focus();m.querySelector('input[name="id"]').value="relate"}else{m.querySelector('input[name="id"]').value=q.recObj.objects[0].id;$("multiuse-button2").click()}};o.onerror=cr.errorHandler;o.send()}},true)})}function d(m){return function(){cr.ui.changeSelection(a);document.title="VCD/DVD Library | Film Society, HKUSTSU";m.apply(this,arguments)}}function k(){var m=$("multiuseOverlay"),s=m.querySelector("h1"),r=m.querySelector(".content-area"),q=$("multiuse-button1"),o=$("multiuse-button2"),n=$("multiuse-button3");cr.ui.resetMultiuse();s.textContent="Create New Disk";q.textContent="Save As Draft";q.removeAttribute("hidden");o.textContent="Publish";o.removeAttribute("hidden");n.textContent="Cancel";n.removeAttribute("hidden");m.eventTracker.add(n,"click",function(){cr.dispatchSimpleEvent(m,"cancelOverlay")});cr.ui.overlay.showOverlay(m);var p=cr.ui.template.render_template("admin/disk_create.html");r.appendChild(p);m.eventTracker.add(q,"click",function(){cr.ui.showLoading();var t=Application.collectForm(r);if(t.cover_url==="uploading"){alertOverlay.setValues("Warning","Cover is still uploading","OK",null,function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay")},null);cr.ui.hideLoading();cr.ui.overlay.showOverlay($("alertOverlay"));return}t.avail_type="Draft";cr.model.Disk.post(t,function(){cr.ui.hideLoading();cr.dispatchSimpleEvent(m,"cancelOverlay");history.go();cr.ui.showNotification("Saved","dismiss")})});m.eventTracker.add(o,"click",function(){cr.ui.showLoading();var t=Application.collectForm(r);if(t.cover_url==="uploading"){alertOverlay.setValues("Warning","Cover is still uploading","OK",null,function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay")},null);cr.ui.hideLoading();cr.ui.overlay.showOverlay($("alertOverlay"));return}t.avail_type="Available";cr.model.Disk.post(t,function(){cr.ui.hideLoading();cr.dispatchSimpleEvent(m,"cancelOverlay");history.go();cr.ui.showNotification("Saved","dismiss")})})}function e(r){var m=$("multiuseOverlay"),q=m.querySelector("h1"),p=m.querySelector(".content-area"),o=$("multiuse-button2"),n=$("multiuse-button3");cr.ui.resetMultiuse();q.textContent="Edit Disk Information";o.textContent="Save";o.removeAttribute("hidden");n.textContent="Cancel";n.removeAttribute("hidden");m.eventTracker.add(n,"click",function(){cr.dispatchSimpleEvent(m,"cancelOverlay")});cr.ui.overlay.showOverlay(m);cr.model.Disk.get(r,function(u){var t=cr.ui.template.render_template("admin/disk_edit.html",{disk:u,cn:j(u)});p.appendChild(t);if(u.avail_type==="Draft"){var s=$("multiuse-button1");s.textContent="Publish";s.removeAttribute("hidden");m.eventTracker.add(s,"click",function(){cr.ui.showLoading();var v=Application.collectForm(p);if(v.cover_url==="uploading"){alertOverlay.setValues("Warning","Cover is still uploading","OK",null,function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay")},null);cr.ui.hideLoading();cr.ui.overlay.showOverlay($("alertOverlay"));return}v.avail_type="Available";cr.model.Disk.put(r,v,true,function(){cr.ui.hideLoading();cr.dispatchSimpleEvent(m,"cancelOverlay");history.go();cr.ui.showNotification("Saved","dismiss")})})}m.eventTracker.add(o,"click",function(){cr.ui.showLoading();var v=Application.collectForm(p);if(v.cover_url==="uploading"){alertOverlay.setValues("Warning","Cover is still uploading","OK",null,function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay")},null);cr.ui.hideLoading();cr.ui.overlay.showOverlay($("alertOverlay"));return}cr.model.Disk.put(r,v,true,function(){cr.ui.hideLoading();cr.dispatchSimpleEvent(m,"cancelOverlay");history.go();cr.ui.showNotification("Saved","dismiss")})})})}function i(m){alertOverlay.setValues("Confirm Delete","Confirm delete Disk "+j(m)+"?","Delete","Cancel",function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay");cr.ui.showLoading();cr.model.Disk.remove(m.id,function(){cr.ui.hideLoading();history.go();cr.ui.showNotification("Deleted","dismiss")})},function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay")});cr.ui.overlay.showOverlay($("alertOverlay"))}function g(r){var m=$("multiuseOverlay"),s=m.querySelector("h1"),q=m.querySelector(".content-area"),o=$("multiuse-button2"),n=$("multiuse-button3");cr.ui.resetMultiuse();s.textContent="Check out Disk "+j(r);o.textContent="Check out";o.removeAttribute("hidden");n.textContent="Cancel";n.removeAttribute("hidden");m.eventTracker.add(n,"click",function(){cr.dispatchSimpleEvent(m,"cancelOverlay")});cr.ui.overlay.showOverlay(m);var p=cr.ui.template.render_template("admin/disk_checkout.html",{disk:r,due_at:cr.model.SiteSettings.getField("due_date").value});q.appendChild(p);m.eventTracker.add(o,"click",function(){cr.ui.showLoading();var w=new cr.APIRequest(cr.model.Disk,"POST","/"+r.id+"/borrow/"),t=p.querySelector('input[name="id"]').value;w.onload=function(){cr.ui.hideLoading();cr.dispatchSimpleEvent(m,"cancelOverlay");history.go();cr.ui.showNotification("Checked out","dismiss")};w.onerror=cr.errorHandler;if(t==="relate"){var v=q.querySelector('input[name="student_id"]').value,u=q.querySelector('input[name="university_id"]').value;if(v&&u){var x=new cr.APIRequest(cr.model.User,"POST","/relation/");x.onload=function(y){w.sendJSON({id:y.recObj.id})};x.onerror=cr.errorHandler;x.sendJSON({student_id:v,university_id:u})}else{if(v){var x=new cr.APIRequest(cr.model.User,"GET","/?student_id="+v);x.onload=function(z){if(z.recObj.objects.length===0){var y=new cr.Event("error",false,true);y.recObj={errno:2,error:"User not exist"};cr.errorHandler(y)}else{w.sendJSON({id:z.recObj.objects[0].id})}};x.onerror=cr.errorHandler;x.send()}else{q.querySelector('input[name="student_id"]').focus()}}}else{w.sendJSON({id:t})}})}function b(m){alertOverlay.setValues("Confirm Checkin","Check the disk "+j(m)+" before confirming!","Check in","Cancel",function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay");cr.ui.showLoading();var n=new cr.APIRequest(cr.model.Disk,"DELETE","/"+m.id+"/borrow/");n.onload=function(){cr.ui.hideLoading();history.go();cr.ui.showNotification("Succeeded","dismiss")};n.onerror=cr.errorHandler;n.send()},function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay")});cr.ui.overlay.showOverlay($("alertOverlay"))}function l(m){alertOverlay.setValues("Confirm Renew","Renewing disk "+j(m)+" will postpone the due date to 7 days later!","Renew","Cancel",function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay");cr.ui.showLoading();var n=new cr.APIRequest(cr.model.Disk,"POST","/"+m.id+"/borrow/");n.onload=function(){cr.ui.hideLoading();history.go();cr.ui.showNotification("Renewed","dismiss")};n.onerror=cr.errorHandler;n.sendJSON({id:m.hold_by.id})},function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay")});cr.ui.overlay.showOverlay($("alertOverlay"))}function c(w){var v=w.page||1,p=w.type_filter?w.type_filter.split(","):["Draft","Available","Borrowed","Reserved","ReservedCounter","Voting","Onshow"],o=cr.ui.template.render_template("admin/liba_list.html",{filter:p});cr.ui.replaceContent(o);var m=o.querySelector("list"),u=o.querySelector(".content"),y=o.querySelector("footer"),t="/?page="+v+"&avail_type__in="+p.join(","),n=new cr.Pager(cr.model.Disk,t);cr.ui.displayLoading(u);n.load(q);o.querySelector("#page-prev").addEventListener("click",function(A){v--;routerManager.pushState(x(),false,true);scrollTo(0,0);cr.ui.displayLoading(u);n.prev(q)});o.querySelector("#page-next").addEventListener("click",function(A){v++;routerManager.pushState(x(),false,true);scrollTo(0,0);cr.ui.displayLoading(u);n.next(q)});var s=o.querySelectorAll('header .controls input[type="checkbox"]');for(var r=0;r<s.length;r++){s[r].addEventListener("change",function(B){var A=B.target.getAttribute("filter");if(B.target.checked){p.push(A)}else{p.splice(p.indexOf(A),1)}v=1;t="/?page="+v+"&avail_type__in="+p.join(","),n=new cr.Pager(cr.model.Disk,t);routerManager.pushState(x(),false,true);scrollTo(0,0);cr.ui.displayLoading(u);n.load(q)})}o.querySelector("#liba-view-log").addEventListener("click",function(){cr.logger.showLogger("View Logs of module Disk",{model:"Disk"},cr.model.Disk.types)});o.querySelector("#liba-create-disk").addEventListener("click",k);var z=o.querySelector('header .corner input[type="search"]');z.addEventListener("keydown",function(B){if(B.keyCode===13){if(B.target.value===""){return}var A={q:B.target.value};routerManager.pushState("liba/search/?q="+encodeURIComponent(B.target.value),false,false)}});function q(B){cr.ui.removeLoading(u);m.classList.add("content-loading");m.innerHTML="";for(var A=0;A<B.length;A++){var C=cr.ui.template.render_template("admin/disk_list_item.html",{disk:B[A],cn:j(B[A])});m.appendChild(C)}if(this.has_prev){y.querySelector(".lefthub").removeAttribute("hidden")}else{y.querySelector(".lefthub").setAttribute("hidden","true")}if(this.has_next){y.querySelector(".righthub").removeAttribute("hidden")}else{y.querySelector(".righthub").setAttribute("hidden","true")}y.querySelector(".centerhub > span").textContent=this.page+"/"+this.total;setTimeout(function(){m.classList.remove("content-loading")},100)}function x(){return"liba/?page="+v+"&type_filter="+p.join(",")}}function h(v){var u=v.page||1,o=v.q||"",q=cr.ui.template.render_template("admin/liba_search.html",{query:o});cr.ui.replaceContent(q);var m=q.querySelector("list"),t=q.querySelector(".content"),x=q.querySelector("footer"),s=p(),n=new cr.Pager(cr.model.Disk,s);cr.ui.displayLoading(t);n.load(r);q.querySelector("#page-prev").addEventListener("click",function(z){u--;routerManager.pushState(w(),false,true);scrollTo(0,0);cr.ui.displayLoading(t);n.prev(r)});q.querySelector("#page-next").addEventListener("click",function(z){u++;routerManager.pushState(w(),false,true);scrollTo(0,0);cr.ui.displayLoading(t);n.next(r)});q.querySelector("#liba-view-log").addEventListener("click",function(){cr.logger.showLogger("View Logs of module Disk",{model:"Disk"},cr.model.Disk.types)});q.querySelector("#liba-create-disk").addEventListener("click",k);var y=q.querySelector('header .corner input[type="search"]');y.addEventListener("keydown",function(z){if(z.keyCode===13){if(z.target.value===""){return}o=z.target.value;u=1;s=p();n=new cr.Pager(cr.model.Disk,s);routerManager.pushState(w(),false,true);scrollTo(0,0);cr.ui.displayLoading(t);n.load(r)}});function r(A){cr.ui.removeLoading(t);m.classList.add("content-loading");m.innerHTML="";for(var z=0;z<A.length;z++){var B=cr.ui.template.render_template("admin/disk_list_item.html",{disk:A[z],cn:j(A[z])});m.appendChild(B)}if(this.has_prev){x.querySelector(".lefthub").removeAttribute("hidden")}else{x.querySelector(".lefthub").setAttribute("hidden","true")}if(this.has_next){x.querySelector(".righthub").removeAttribute("hidden")}else{x.querySelector(".righthub").setAttribute("hidden","true")}x.querySelector(".centerhub > span").textContent=this.page+"/"+this.total;setTimeout(function(){m.classList.remove("content-loading")},100)}function w(){return"liba/search/?page="+u+"&q="+encodeURIComponent(o)}function p(){if(/^[AB]\d{4}$/.test(o)){return"/?id="+o.substr(1)}else{return"/search/?page="+u+"&query="+encodeURIComponent(o)}}}return{Initialize:f}});cr.view.liba.Initialize();cr.define("cr.view.review",function(){var b="review";function d(){routerManager.register(/review\//,false,a(e));routerManager.register(/review\/search\//,false,a(c));cr.ui.template.register("admin/review_list.html");cr.ui.template.register("admin/review_list_item.html",function(g){this.querySelector('button[control="delete"]').addEventListener("click",f.bind(null,g.review))})}function a(g){return function(){cr.ui.changeSelection(b);document.title="Disk Review | Film Society, HKUSTSU";g.apply(this,arguments)}}function f(g){alertOverlay.setValues("Confirm Delete","Confirm delete thsi review?","Delete","Cancel",function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay");cr.ui.showLoading();cr.model.DiskReview.remove(g.id,function(){cr.ui.hideLoading();history.go();cr.ui.showNotification("Deleted","dismiss")})},function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay")});cr.ui.overlay.showOverlay($("alertOverlay"))}function e(n){var m=n.page||1,i=cr.ui.template.render_template("admin/review_list.html",{query:""});cr.ui.replaceContent(i);var g=i.querySelector("list"),l=i.querySelector(".content"),p=i.querySelector("footer"),k="/?page="+m,h=new cr.Pager(cr.model.DiskReview,k);cr.ui.displayLoading(l);h.load(j);i.querySelector("#page-prev").addEventListener("click",function(r){m--;routerManager.pushState(o(),false,true);scrollTo(0,0);cr.ui.displayLoading(l);h.prev(j)});i.querySelector("#page-next").addEventListener("click",function(r){m++;routerManager.pushState(o(),false,true);scrollTo(0,0);cr.ui.displayLoading(l);h.next(j)});i.querySelector("#review-view-log").addEventListener("click",function(){cr.logger.showLogger("View Logs of module DiskReview",{model:"DiskReview"},cr.model.DiskReview.types)});var q=i.querySelector('header .corner input[type="search"]');q.addEventListener("keydown",function(s){if(s.keyCode===13){if(s.target.value===""){return}var r={q:s.target.value};routerManager.pushState("review/search/?q="+encodeURIComponent(s.target.value),false,false)}});function j(s){cr.ui.removeLoading(l);g.classList.add("content-loading");g.innerHTML="";for(var r=0;r<s.length;r++){var t=cr.ui.template.render_template("admin/review_list_item.html",{review:s[r]});g.appendChild(t)}if(this.has_prev){p.querySelector(".lefthub").removeAttribute("hidden")}else{p.querySelector(".lefthub").setAttribute("hidden","true")}if(this.has_next){p.querySelector(".righthub").removeAttribute("hidden")}else{p.querySelector(".righthub").setAttribute("hidden","true")}p.querySelector(".centerhub > span").textContent=this.page+"/"+this.total;setTimeout(function(){g.classList.remove("content-loading")},100)}function o(){return"review/?page="+m}}function c(o){var n=o.page||1,i=o.q||"",j=cr.ui.template.render_template("admin/review_list.html",{query:i});cr.ui.replaceContent(j);var g=j.querySelector("list"),m=j.querySelector(".content"),q=j.querySelector("footer"),l;if(/^[AB]\d{4}$/.test(i)){l="/?disk="+i.substr(1).replace(/^0+/g,"")+"&page="+n}else{l="/search/?page="+n+"&query="+encodeURIComponent(i)}var h=new cr.Pager(cr.model.DiskReview,l);cr.ui.displayLoading(m);h.load(k);j.querySelector("#page-prev").addEventListener("click",function(s){n--;routerManager.pushState(p(),false,true);scrollTo(0,0);cr.ui.displayLoading(m);h.prev(k)});j.querySelector("#page-next").addEventListener("click",function(s){n++;routerManager.pushState(p(),false,true);scrollTo(0,0);cr.ui.displayLoading(m);h.next(k)});j.querySelector("#review-view-log").addEventListener("click",function(){cr.logger.showLogger("View Logs of module DiskReview",{model:"DiskReview"},cr.model.DiskReview.types)});var r=j.querySelector('header .corner input[type="search"]');r.addEventListener("keydown",function(s){if(s.keyCode===13){if(s.target.value===""){return}i=s.target.value;n=1;if(/^[AB]\d{4}$/.test(i)){l="/?disk="+i.substr(1).replace(/^0+/g,"")+"&page="+n}else{l="/search/?page="+n+"&query="+encodeURIComponent(i)}h=new cr.Pager(cr.model.DiskReview,l);routerManager.pushState(p(),false,true);scrollTo(0,0);cr.ui.displayLoading(m);h.load(k)}});function k(t){cr.ui.removeLoading(m);g.classList.add("content-loading");g.innerHTML="";for(var s=0;s<t.length;s++){var u=cr.ui.template.render_template("admin/review_list_item.html",{review:t[s]});g.appendChild(u)}if(this.has_prev){q.querySelector(".lefthub").removeAttribute("hidden")}else{q.querySelector(".lefthub").setAttribute("hidden","true")}if(this.has_next){q.querySelector(".righthub").removeAttribute("hidden")}else{q.querySelector(".righthub").setAttribute("hidden","true")}q.querySelector(".centerhub > span").textContent=this.page+"/"+this.total;setTimeout(function(){g.classList.remove("content-loading")},100)}function p(){return"review/search/?page="+n+"&q="+encodeURIComponent(i)}}return{Initialize:d}});cr.view.review.Initialize();cr.define("cr.view.onesentence",function(){var a="onesentence";function d(){routerManager.register(/onesentence\//,false,b(e));routerManager.register(/onesentence\/search\//,false,b(c));cr.ui.template.register("admin/ons_list.html");cr.ui.template.register("admin/ons_list_item.html",function(i){this.querySelector('button[control="edit"]').addEventListener("click",(function(j){g(j.id)}).bind(null,i.ons));this.querySelector('button[control="delete"]').addEventListener("click",f.bind(null,i.ons))});cr.ui.template.register("admin/ons_form.html")}function b(i){return function(){cr.ui.changeSelection(a);document.title="One Sentence | Film Society, HKUSTSU";i.apply(this,arguments)}}function h(){var i=$("multiuseOverlay"),n=i.querySelector("h1"),m=i.querySelector(".content-area"),k=$("multiuse-button2"),j=$("multiuse-button3");cr.ui.resetMultiuse();n.textContent="Create New One Sentence";k.textContent="Create";k.removeAttribute("hidden");j.textContent="Cancel";j.removeAttribute("hidden");i.eventTracker.add(j,"click",function(){cr.dispatchSimpleEvent(i,"cancelOverlay")});cr.ui.overlay.showOverlay(i);var l=cr.ui.template.render_template("admin/ons_form.html",{ons:{}});m.appendChild(l);i.eventTracker.add(k,"click",function(){cr.ui.showLoading();var o=Application.collectForm(m);cr.model.OneSentence.post(o,function(){cr.ui.hideLoading();cr.dispatchSimpleEvent(i,"cancelOverlay");history.go();cr.ui.showNotification("Saved","dismiss")})})}function g(n){var i=$("multiuseOverlay"),m=i.querySelector("h1"),l=i.querySelector(".content-area"),k=$("multiuse-button2"),j=$("multiuse-button3");cr.ui.resetMultiuse();m.textContent="Edit One Sentence";k.textContent="Save";k.removeAttribute("hidden");j.textContent="Cancel";j.removeAttribute("hidden");i.eventTracker.add(j,"click",function(){cr.dispatchSimpleEvent(i,"cancelOverlay")});cr.ui.overlay.showOverlay(i);cr.model.OneSentence.get(n,function(p){var o=cr.ui.template.render_template("admin/ons_form.html",{ons:p});l.appendChild(o);i.eventTracker.add(k,"click",function(){cr.ui.showLoading();var q=Application.collectForm(l);cr.model.OneSentence.put(n,q,true,function(){cr.ui.hideLoading();cr.dispatchSimpleEvent(i,"cancelOverlay");history.go();cr.ui.showNotification("Saved","dismiss")})})})}function f(i){alertOverlay.setValues("Confirm Delete","Confirm delete onesentence "+i.content+"?","Delete","Cancel",function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay");cr.ui.showLoading();cr.model.OneSentence.remove(i.id,function(){cr.ui.hideLoading();history.go();cr.ui.showNotification("Deleted","dismiss")})},function(){cr.dispatchSimpleEvent($("alertOverlay"),"cancelOverlay")});cr.ui.overlay.showOverlay($("alertOverlay"))}function e(p){var o=p.page||1,k=cr.ui.template.render_template("admin/ons_list.html",{query:""});cr.ui.replaceContent(k);var i=k.querySelector("list"),n=k.querySelector(".content"),r=k.querySelector("footer"),m="/?page="+o,j=new cr.Pager(cr.model.OneSentence,m);cr.ui.displayLoading(n);j.load(l);k.querySelector("#page-prev").addEventListener("click",function(t){o--;routerManager.pushState(q(),false,true);scrollTo(0,0);cr.ui.displayLoading(n);j.prev(l)});k.querySelector("#page-next").addEventListener("click",function(t){o++;routerManager.pushState(q(),false,true);scrollTo(0,0);cr.ui.displayLoading(n);j.next(l)});k.querySelector("#ons-view-log").addEventListener("click",function(){cr.logger.showLogger("View Logs of module OneSentence",{model:"OneSentence"},cr.model.OneSentence.types)});k.querySelector("#ons-create-onesentence").addEventListener("click",h);var s=k.querySelector('header .corner input[type="search"]');s.addEventListener("keydown",function(u){if(u.keyCode===13){if(u.target.value===""){return}var t={q:u.target.value};routerManager.pushState("onesentence/search/?q="+encodeURIComponent(u.target.value),false,false)}});function l(u){cr.ui.removeLoading(n);i.classList.add("content-loading");i.innerHTML="";for(var t=0;t<u.length;t++){var v=cr.ui.template.render_template("admin/ons_list_item.html",{ons:u[t]});i.appendChild(v)}if(this.has_prev){r.querySelector(".lefthub").removeAttribute("hidden")}else{r.querySelector(".lefthub").setAttribute("hidden","true")}if(this.has_next){r.querySelector(".righthub").removeAttribute("hidden")}else{r.querySelector(".righthub").setAttribute("hidden","true")}r.querySelector(".centerhub > span").textContent=this.page+"/"+this.total;setTimeout(function(){i.classList.remove("content-loading")},100)}function q(){return"onesentence/?page="+o}}function c(q){var p=q.page||1,k=q.q||"",l=cr.ui.template.render_template("admin/ons_list.html",{query:k});cr.ui.replaceContent(l);var i=l.querySelector("list"),o=l.querySelector(".content"),s=l.querySelector("footer"),n="/search/?page="+p+"&query="+encodeURIComponent(k),j=new cr.Pager(cr.model.OneSentence,n);cr.ui.displayLoading(o);j.load(m);l.querySelector("#page-prev").addEventListener("click",function(u){p--;routerManager.pushState(r(),false,true);scrollTo(0,0);cr.ui.displayLoading(o);j.prev(m)});l.querySelector("#page-next").addEventListener("click",function(u){p++;routerManager.pushState(r(),false,true);scrollTo(0,0);cr.ui.displayLoading(o);j.next(m)});l.querySelector("#ons-view-log").addEventListener("click",function(){cr.logger.showLogger("View Logs of module OneSentence",{model:"OneSentence"},cr.model.OneSentence.types)});l.querySelector("#ons-create-onesentence").addEventListener("click",h);var t=l.querySelector('header .corner input[type="search"]');t.addEventListener("keydown",function(u){if(u.keyCode===13){if(u.target.value===""){return}k=u.target.value;p=1;n="/search/?page="+p+"&query="+encodeURIComponent(k);j=new cr.Pager(cr.model.OneSentence,n);routerManager.pushState(r(),false,true);scrollTo(0,0);cr.ui.displayLoading(o);j.load(m)}});function m(v){cr.ui.removeLoading(o);i.classList.add("content-loading");i.innerHTML="";for(var u=0;u<v.length;u++){var w=cr.ui.template.render_template("admin/ons_list_item.html",{ons:v[u]});i.appendChild(w)}if(this.has_prev){s.querySelector(".lefthub").removeAttribute("hidden")}else{s.querySelector(".lefthub").setAttribute("hidden","true")}if(this.has_next){s.querySelector(".righthub").removeAttribute("hidden")}else{s.querySelector(".righthub").setAttribute("hidden","true")}s.querySelector(".centerhub > span").textContent=this.page+"/"+this.total;setTimeout(function(){i.classList.remove("content-loading")},100)}function r(){return"onesentence/search/?page="+p+"&q="+encodeURIComponent(k)}}return{Initialize:d}});cr.view.onesentence.Initialize();cr.define("cr.view.settings",function(){var b="settings";function c(){routerManager.register(/settings\//,false,d(a));cr.ui.template.register("admin/settings.html",function(){var g=this.querySelectorAll('button[type="submit"]'),f=this;for(var e=0;e<g.length;e++){g[e].addEventListener("click",function(){var i=this.getAttribute("control"),h=f.querySelector('*[name="'+i+'"]'),j=h.value,k=cr.model.SiteSettings.getField(i).id;cr.ui.showLoading();cr.model.SiteSettings.put(k,{value:j},true,function(){cr.ui.hideLoading();cr.ui.showNotification("Saved","dismiss")})})}})}function d(e){return function(){cr.ui.changeSelection(b);document.title="Site Settings | Film Society, HKUSTSU";e.apply(this,arguments)}}function a(){var f=cr.ui.template.render_template("admin/settings.html",{model:cr.model.SiteSettings}),e=f.querySelector(".front-drop img"),g=cr.model.SiteSettings.getField("header_image").value;if(g){cr.model.File.get(g,function(h){e.src=cr.settings.resource_base+"upload/"+h.url})}cr.uploader.init(f.querySelector(".front-drop"),null,function(h){var i=cr.model.SiteSettings.getField("header_image").id;e.src=cr.settings.resource_base+"upload/"+h.url;cr.ui.showLoading();cr.model.SiteSettings.put(i,{value:h.id},true,function(){cr.ui.hideLoading();cr.ui.showNotification("Saved","dismiss")})});cr.ui.replaceContent(f)}return{Initialize:c}});cr.view.settings.Initialize();