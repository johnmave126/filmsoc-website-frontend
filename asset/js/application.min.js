/**
 * Script File of Film Society, HKUSTSU
 * Author: John Tan <johnmave126@gmail.com>
 * All Rights Reserved
 */

function assert(c,b){if(!c){var a="Assertion failed";if(b){a=a+": "+b}throw new Error(a)}}var global=this;function $(a){return document.getElementById(a)}function pad(c,a,b){b=b||"0";c=c+"";return c.length>=a?c:new Array(a-c.length+1).join(b)+c}function url(b){var a=b.replace(/(\(|\)|\,|\s|\'|\"|\\)/g,"\\$1");if(/\\\\$/.test(a)){a+=" "}return'url("'+a+'")'}function parseQueryParams(a){var f={};var c=unescape(a.search.substring(1));var d=c.split("&");for(var b=0;b<d.length;b++){var e=d[b].split("=");f[e[0]]=e[1]}return f}function findAncestorByClass(b,a){return findAncestor(b,function(c){if(c.classList){return c.classList.contains(a)}return null})}function findAncestor(c,a){var b=false;while(c!=null&&!(b=a(c))){c=c.parentNode}return b?c:null}function swapDomNodes(d,c){var f=d.nextSibling;if(f==c){swapDomNodes(c,d);return}var e=d.parentNode;c.parentNode.replaceChild(d,c);e.insertBefore(c,f)}function disableTextSelectAndDrag(b,a){document.onselectstart=function(c){if(!(b&&b.call(this,c))){c.preventDefault()}};document.ondragstart=function(c){if(!(a&&a.call(this,c))){c.preventDefault()}}}function preventDefaultOnPoundLinkClicks(){document.addEventListener("click",function(b){var a=findAncestor(b.target,function(c){return c.tagName=="A"});if(a&&a.getAttribute("href")=="#"){b.preventDefault()}})}function getRequiredElement(b){var a=$(b);assert(a,"Missing required element: "+b);return a}(function(){if(!Element.prototype.matches){if(Element.prototype.webkitMatchesSelector){Element.prototype.matches=Element.prototype.webkitMatchesSelector}else{if(Element.prototype.mozMatchesSelector){Element.prototype.matches=Element.prototype.mozMatchesSelector}else{if(Element.prototype.oMatchesSelector){Element.prototype.matches=Element.prototype.oMatchesSelector}else{if(Element.prototype.msMatchesSelector){Element.prototype.matches=Element.prototype.msMatchesSelector}}}}}assert(Element.prototype.matches,"Unsupported Browser")})();function createElementWithClassName(b,a){var c=document.createElement(b);c.className=a;return c}function extend(c,a){var b=function(){};b.prototype=a.prototype;c.prototype=new b();c.prototype.constructor=c;c.prototype.extend=function(d){assert(this.hasOwnProperty("extend"),"Only prototype callable");for(var e in d){if(d.hasOwnProperty(e)){this[e]=d[e]}}};c.uber=a.prototype}function superCall(a,b){assert(a.uber,"Not a subclass of any class");assert(a.uber[b] instanceof Function,"super class has no functin specified");return a.uber[b].bind(a)}function deepCopy(d){if(d==null||typeof(d)!=="object"){return d}if(typeof d.clone=="function"){return d.clone(true)}if(d instanceof Date){return new Date(d.getTime())}if(d instanceof RegExp){return new RegExp(d)}if(d.nodeType&&typeof d.cloneNode=="function"){return d.cloneNode(true)}if(d instanceof Array){return d.slice(0)}var c=(Object.getPrototypeOf?Object.getPrototypeOf(d):d.__proto__);if(!c){c=d.constructor.prototype}var a=Object.create(c);for(var b in d){a[b]=deepCopy(d[b])}return a}(function(){if(!Function.prototype.bind){Function.prototype.bind=function(a){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var e=Array.prototype.slice.call(arguments,1),d=this,b=function(){},c=function(){return d.apply(this instanceof b&&a?this:a,e.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;c.prototype=new b();return c}}})();var EventTracker=(function(){function a(){this.listeners_=[]}a.Entry;a.prototype={add:function(e,c,f,b){var d={node:e,eventType:c,listener:f,capture:b};this.listeners_.push(d);e.addEventListener(c,f,b)},remove:function(c,b){this.listeners_=this.listeners_.filter(function(d){if(d.node==c&&(!b||(d.eventType==b))){a.removeEventListener_(d);return false}return true})},removeAll:function(){this.listeners_.forEach(a.removeEventListener_);this.listeners_=[]}};a.removeEventListener_=function(b){b.node.removeEventListener(b.eventType,b.listener,b.capture)};return a})();var global=this;this.cr=(function(){function n(r,p,u){var s=r.split(".");var t=u||global;for(var q;s.length&&(q=s.shift());){if(!s.length&&p!==undefined){t[q]=p}else{if(q in t){t=t[q]}else{t=t[q]={}}}}return t}function g(t,p,s,q){var r=new cr.Event(p+"Change");r.propertyName=p;r.newValue=s;r.oldValue=q;t.dispatchEvent(r)}function c(p){return p.replace(/([A-Z])/g,"-$1").toLowerCase()}var j={JS:"js",ATTR:"attr",BOOL_ATTR:"boolAttr"};function e(q,s){switch(s){case j.JS:var r=q+"_";return function(){return this[r]};case j.ATTR:var p=c(q);return function(){return this.getAttribute(p)};case j.BOOL_ATTR:var p=c(q);return function(){return this.hasAttribute(p)}}}function o(q,s,t){switch(s){case j.JS:var r=q+"_";return function(v){var u=this[q];if(v!==u){this[r]=v;if(t){t.call(this,v,u)}g(this,q,v,u)}};case j.ATTR:var p=c(q);return function(v){var u=this[q];if(v!==u){if(v==undefined){this.removeAttribute(p)}else{this.setAttribute(p,v)}if(t){t.call(this,v,u)}g(this,q,v,u)}};case j.BOOL_ATTR:var p=c(q);return function(v){var u=this[q];if(v!==u){if(v){this.setAttribute(p,q)}else{this.removeAttribute(p)}if(t){t.call(this,v,u)}g(this,q,v,u)}}}}function d(s,p,t,r){if(typeof s=="function"){s=s.prototype}var q=t||j.JS;if(!s.__lookupGetter__(p)){s.__defineGetter__(p,e(p,q))}if(!s.__lookupSetter__(p)){s.__defineSetter__(p,o(p,q,r))}}var f=1;function a(){return f++}function b(p){if(p.hasOwnProperty("uid")){return p.uid}return p.uid=a()}function i(t,r,q,p){var s=new cr.Event(r,q,p);return t.dispatchEvent(s)}function k(t,p){var u=n(t);var r=p();for(var q in r){var s=Object.getOwnPropertyDescriptor(r,q);if(s){Object.defineProperty(u,q,s)}}}function l(p){p.getInstance=function(){return p.instance_||(p.instance_=new p())}}function m(r,q,p){var s=cr.doc.createEvent("Event");s.initEvent(r,!!q,!!p);s.__proto__=global.Event.prototype;return s}function h(){if(!global.document){var p=cr;Object.defineProperty(global,"cr",{get:function(){Object.defineProperty(global,"cr",{value:p});p.initialize();return p},configurable:true});return}m.prototype={__proto__:global.Event.prototype};cr.doc=document}return{addSingletonGetter:l,createUid:a,define:k,defineProperty:d,dispatchPropertyChange:g,dispatchSimpleEvent:i,Event:m,getUid:b,initialize:h,PropertyKind:j}})();cr.initialize();cr.define("cr",function(){function a(){}a.prototype={addEventListener:function(d,c){if(!this.listeners_){this.listeners_=Object.create(null)}if(!(d in this.listeners_)){this.listeners_[d]=[c]}else{var b=this.listeners_[d];if(b.indexOf(c)<0){b.push(c)}}},removeEventListener:function(e,d){if(!this.listeners_){return}if(e in this.listeners_){var b=this.listeners_[e];var c=b.indexOf(d);if(c>=0){if(b.length==1){delete this.listeners_[e]}else{b.splice(c,1)}}}},dispatchEvent:function(g){if(this["on"+g.type]){return this["on"+g.type].call(this,g)}if(!this.listeners_){return true}var c=this;g.__defineGetter__("target",function(){return c});g.preventDefault=function(){this.returnValue=false};var f=g.type;var h=0;if(f in this.listeners_){var b=this.listeners_[f].concat();for(var d=0,e;e=b[d];d++){if(e.handleEvent){h|=e.handleEvent.call(e,g)===false}else{h|=e.call(this,g)===false}}}return !h&&g.returnValue}};return{EventTarget:a}});cr.define("cr.settings",function(){return{resource_base:"http://ihome.ust.hk/~su_film/asset/",api_base:"http://dma080.resnet.ust.hk:49000/film/api/",login_url:"http://dma080.resnet.ust.hk:49000/film/member/login/",logout_url:"http://dma080.resnet.ust.hk:49000/film/member/logout/"}});cr.define("cr.ui.template",function(){var templates={},BBHandler=[{pattern:/\[b\](.*?)\[\/b\]/ig,repl:"<b>$1</b>"},{pattern:/\[i\](.*?)\[\/i\]/ig,repl:"<em>$1</em>"},{pattern:/\[u\](.*?)\[\/u\]/ig,repl:"<u>$1</u>"},{pattern:/\[big\](.*?)\[\/big\]/ig,repl:"<big>$1</big>"},{pattern:/\[small\](.*?)\[\/small\]/ig,repl:"<small>$1</small>"},{pattern:/\[color=([a-zA-Z]*|\#?[0-9a-fA-F]{6})\](.*?)\[\/color\]/ig,repl:'<span style="color:$1">$2</span>'},{pattern:/\[link\=\s*((?:(?:ftp|https?):\/\/)?(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,6}\.?|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+))\s*\](.+)\[\/link\]/ig,repl:'<a href="$1">$2</a>'},{pattern:/\[img\=\s*((?:(?:ftp|https?):\/\/)?(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,6}\.?|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+))\s*\](.+)\[\/img\]/ig,repl:'<img src="$1" alt="$2" title="$2">'}];function escapeWrap(value){return"<p>"+value.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;").replace("'","&#x27;").replace("/","&#x2F;").replace("\n","</p><p>")+"</p>"}function escapeAttr(value){return value.replace('"',"&quot;").replace("'","&#x27;")}function escapeHTML(value){return value.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;").replace("'","&#x27;").replace("/","&#x2F;").replace("\n"," ")}function escapeBBCode(value){value=escapeHTML(value);for(var i=0;i<BBHandler.length;i++){var dup_value;do{dup_value=value;value=value.replace(BBHandler[i].pattern,BBHandler[i].repl)}while(dup_value!=value)}return value}function render_template(url,param){var template=templates[url],wrapper=document.createElement("div"),item,text,func_head,func_bottom;if(template===undefined){throw new ReferenceError("Undefined template.")}param=param||{};text=template.content||"";var argn=[],args=[];for(var prop in param){if(param.hasOwnProperty(prop)&&/^[_a-zA-Z][_a-zA-Z0-9]*$/.test(prop)){argn.push(prop);args.push("param."+prop)}}func_head="(function("+argn.join(",")+"){ return eval('";func_bottom="');})("+args.join(",")+")";var html=text.replace(/{{(.*?)}}/g,function(m,value){var arg_list,escaper=escapeHTML;value=value.trim();arg_list=value.split("|");if(arg_list[1]){switch(arg_list[1].trim()){case"safe":escaper=function(value){return value};break;case"attr":escaper=escapeAttr;break;case"bbcode":escaper=escapeBBCode;break;case"wrap":escaper=escapeWrap;break;default:break}}var result=eval(func_head+arg_list[0].trim().replace(/'/g,"\\'")+func_bottom);if(result!=undefined){result=""+result}else{result=""}return escaper(result)});wrapper.innerHTML=html;item=wrapper.firstChild||document.createElement("div");if(template.callback){template.callback.call(item,param)}return item}function globalInitialization(){var pending=[],complete_cnt=0;for(var url in templates){var xhr=new XMLHttpRequest();xhr.open("GET",cr.settings.resource_base+"templates/"+url,true);xhr.onload=(function(url){templates[url].content=this.responseText.trim();complete_cnt++;if(complete_cnt==pending.length){cr.dispatchSimpleEvent(window,"moduleload",false,false)}}).bind(xhr,url);xhr.onerror=function(e){e.recObj={errno:xhr.status,error:""};cr.errorHandler(e)};pending.push(xhr)}for(var i=0;i<pending.length;i++){pending[i].send(null)}if(pending.length===0){cr.dispatchSimpleEvent(window,"moduleload",false,false)}}function register(url,callback){templates[url]={content:null,callback:callback}}function registerBBCode(pattern,repl){assert(pattern instanceof RegExp,"pattern must be RegExp");BBHandler.push({pattern:pattern,repl:repl})}return{globalInitialization:globalInitialization,render_template:render_template,register:register,registerBBCode:registerBBCode,escapeAttr:escapeAttr}});document.addEventListener("DOMContentLoaded",cr.ui.template.globalInitialization);cr.define("cr",function(){function a(c){Object.defineProperty(this,"name",{value:c});this._cache={};this.fields=[]}function b(c,g,d,f){var e=cr.settings.api_base+c.name+d;this.xhr=new XMLHttpRequest();if(g==="GET"&&f){this.xhr.open(g,e+((/\?/).test(e)?"&":"?")+(new Date()).getTime(),true)}else{this.xhr.open(g,e,true)}this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");this.xhr.withCredentials=true;this.xhr.onprogress=(function(h){if(this.onloadprogress){this.onloadprogress(h)}}).bind(this);this.xhr.upload.onprogress=(function(h){if(this.onuploadprogress){this.onuploadprogress(h)}}).bind(this);this.xhr.onreadystatechange=(function(){if(this.xhr.readyState===4){var j;if(this.xhr.status===200){try{var i=JSON.parse(this.xhr.responseText);this.success=i.errno===0;this.data=i;j=new cr.Event((i.errno===0)?"load":"error",false,true);j.recObj=i}catch(h){this.success=false;this.data={errno:2,error:"Error receiving data"};j=new cr.Event("error",false,true);j.recObj={errno:2,error:"Error receiving data"}}}else{this.success=false;this.data={errno:this.xhr.status,error:this.xhr.statusText};j=new cr.Event("error",false,true);j.recObj={errno:this.xhr.status,error:this.xhr.statusText}}this.dispatchEvent(j)}}).bind(this)}extend(b,cr.EventTarget);b.prototype.extend({onload:null,onerror:null,onuploadprogress:null,onloadprogress:null,send:function(){this.xhr.send()},sendRaw:function(c){this.xhr.send(c)},sendForm:function(c){this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.xhr.send(c)},sendJSON:function(c){this.xhr.setRequestHeader("Content-Type","application/json");this.xhr.send(JSON.stringify(c))}});a.prototype={update:function(d,e){if(!this._cache[d.id]){this._cache[d.id]={data:{}}}for(var c in d){if(this.fields.indexOf(c)!==-1){this._cache[d.id].data[c]=d[c]}}this._cache[d.id].dirty=e},get:function(e,d){if(this._cache[e]&&this._cache[e].dirty>0){if(d){d(deepCopy(this._cache[e].data))}}else{var c=new b(this,"GET","/"+e+"/",this._cache[e]);c.onload=(function(f){this.update(f.recObj,1);if(d){d(deepCopy(this._cache[e].data))}}).bind(this);c.onerror=function(f){cr.errorHandler(f)};c.send()}},put:function(g,d,f,e){var c=new b(this,"PUT","/"+g+"/");c.onload=(function(h){if(f){this.update(h.recObj,2)}if(e){e(deepCopy(this._cache[g].data))}}).bind(this);c.onerror=function(h){cr.errorHandler(h)};c.sendJSON(d)},post:function(d,e){var c=new b(this,"POST","/");c.onload=(function(f){this.update(f.recObj,2);if(e){e(deepCopy(this._cache[f.recObj.id].data))}}).bind(this);c.onerror=function(f){cr.errorHandler(f)};c.sendJSON(d)},remove:function(e,d){var c=new b(this,"DELETE","/"+e+"/");c.onload=(function(f){if(this._cache[f.recObj.id]){delete this._cache[f.recObj.id]}if(d){d(f.recObj)}}).bind(this);c.onerror=function(f){cr.errorHandler(f)};c.send()},setup:function(e){if(e){var c=6*60*1000;var d=(function(){var f=new b(this,"GET","/dirty/",true);f.onerror=function(g){if(g.recObj.errno!==403){setTimeout(d,c)}};f.onload=(function(h){for(var g=0;g<h.recObj.dirty.length;g++){if(this._cache[h.recObj.dirty[g]]){this._cache[h.recObj.dirty[g]].dirty--}}}).bind(this);f.send()}).bind(this);setTimeout(d,c)}}};return{BaseModel:a,APIRequest:b}});cr.define("cr",function(){function c(d,e){Object.defineProperty(this,"model",{value:d});Object.defineProperty(this,"has_prev",{get:function(){return this._cache[this.pos].meta.previous.length>0}});Object.defineProperty(this,"has_next",{get:function(){return this._cache[this.pos].meta.next.length>0}});Object.defineProperty(this,"page",{get:function(){return this._cache[this.pos].meta.page}});Object.defineProperty(this,"total",{get:function(){return this._cache[this.pos].meta.total}});Object.defineProperty(this,"obj_list",{get:function(){return this._cache[this.pos].objects}});this._cache={};this.pos=0;(a.bind(this))(e,0)}function b(f,h){var g=[],d=0;for(var e=0;e<f.objects.length;e++){this.model.get(f.objects[e],(function(j,i){g[j]=i;d++;if(d===f.objects.length){if(h){h.call(this,g)}}}).bind(this,e))}}function a(e,g,f){if(this._cache[g]){if(this._cache[g].state===1){(b.bind(this))(this._cache[g],f)}else{this._cache[g].callback=f}}else{if(!e){return}this._cache[g]={state:0,callback:f,objects:[],meta:{}};var d=new cr.APIRequest(this.model,"GET",e);d.onload=(function(k){var j=this._cache[g],l=k.recObj;j.meta=deepCopy(l.meta);for(var h=0;h<l.objects.length;h++){this.model.update(l.objects[h],1);j.objects.push(l.objects[h].id)}j.state=1;if(j.callback){j.callback.call(this,l.objects)}}).bind(this);d.onerror=cr.errorHandler;d.send()}}c.prototype={load:function(d){(a.bind(this))(null,this.pos,function(){if(d){d.apply(this,arguments)}if(!this._cache[this.pos+1]){(a.bind(this))(this._cache[this.pos].meta.next,this.pos+1,null)}if(!this._cache[this.pos-1]){(a.bind(this))(this._cache[this.pos].meta.previous,this.pos-1,null)}})},next:function(d){if(this._cache[this.pos].meta.next){this.pos++}(a.bind(this))(null,this.pos,function(){if(d){d.apply(this,arguments)}if(!this._cache[this.pos+1]){(a.bind(this))(this._cache[this.pos].meta.next,this.pos+1,null)}})},prev:function(d){if(this._cache[this.pos].meta.previous){this.pos--}(a.bind(this))(null,this.pos,function(){if(d){d.apply(this,arguments)}if(!this._cache[this.pos-1]){(a.bind(this))(this._cache[this.pos].meta.previous,this.pos-1,null)}})}};return{Pager:c}});cr.define("routerManager",function(){function c(){return location.hash.substr(1)}function f(k){var n={};var l=k.split("&");for(var j=0;j<l.length;j++){var m=l[j].split("=");n[m[0]]=decodeURIComponent(m[1])}return n}function e(){var o=c(),n;var m=o.indexOf("?");if(m===-1){n={}}else{n=o.slice(m+1,o.length);n=f(n);o=o.slice(0,m)}if(o.length===0){this.pushState(this.defaultRouter.url,true);this.defaultRouter.callback.apply(this.defaultRouter,k);return}if(o[o.length-1]!=="/"){o=o+"/"}for(var l=0;l<this.routers.length;l++){var j=this.routers[l];if(j.re.test(o)){var k;o.replace(j.re,function(){var p=Array.prototype.indexOf.call(arguments,0);k=Array.prototype.slice.call(arguments,1,p);for(var q=0;q<k.length;q++){k[q]=a(k[q])}});k.push(n);j.callback.apply(j,k);return}}cr.notFoundHandler(o)}function b(){window.addEventListener("authload",(function(){window.onpopstate=e.bind(this);this.parseHash()}).bind(this));this.routers=[];this.notFoundHandler=function(){};this.defaultRouter={url:"",callback:function(){},re:new RegExp("")}}function d(i){return i.replace("!","!0").replace("/","!1")}function a(i){return i.replace("!1","/").replace("!0","!")}function h(j,k,l){if(j===c()){return}var i=!k?window.history.pushState:window.history.replaceState;i.call(window.history,{},"","#"+j);if(!l){this.parseHash()}}function g(k,j,l){assert(k instanceof RegExp,"Regular Expression wanted");var i={url:k.source.replace("\\/","/"),callback:l,re:new RegExp("^"+k.source+"$")};this.routers.push(i);if(j===true){this.defaultRouter=i}}return{globalInitialization:b,encodeComponent:d,decodeComponent:a,pushState:h,register:g,parseHash:e}});routerManager.globalInitialization();cr.define("cr.ui",function(){function b(l,j){var k;if(typeof l=="string"){k=cr.doc.querySelectorAll(l)}else{k=[l]}for(var g=0,h;h=k[g];g++){if(!(h instanceof j)){j.decorate(h)}}}function a(g,h){var i;if(h&&h.ownerDocument){i=h.ownerDocument}else{i=cr.doc}return i.createElement(g)}function f(h){var g,i;if(typeof h=="function"){g=h;i=""}else{g=a;i=h}function j(l){var m=g(i,l);j.decorate(m);for(var k in l){m[k]=l[k]}return m}j.decorate=function(k){k.__proto__=j.prototype;k.decorate()};return j}function e(g,n,m,i){g.style.width="10px";var t=g.ownerDocument;var o=t.defaultView;var q=o.getComputedStyle(g);var l=o.getComputedStyle(n);var s=q.direction=="rtl";var j=g.getBoundingClientRect();var u=n.getBoundingClientRect();var p=s?u.right-j.right:j.left-u.left;var v=parseInt(q.borderLeftWidth,10)+parseInt(q.paddingLeft,10)+parseInt(q.paddingRight,10)+parseInt(q.borderRightWidth,10);var h=s?parseInt(l.paddingLeft,10):parseInt(l.paddingRight,10);var r=n.clientWidth-p-v-h;if(i){r*=i}function k(){if(g.scrollWidth>r){g.style.width=r+"px"}else{g.style.width=0;var w=g.scrollWidth;if(w<m){g.style.width=m+"px"}else{g.style.width=w+"px"}}}g.addEventListener("input",k);k()}function d(g){if(!window.isFinite(g)){console.error("Pixel value is not a number: "+g)}return Math.round(g)+"px"}function c(k){var j=k.target.ownerDocument;var g=Math.min(1,k.detail);function i(l){l.stopPropagation();l.preventDefault()}function h(l){if(l.detail>g){g=l.detail;i(l)}else{j.removeEventListener("dblclick",i,true);j.removeEventListener("click",h,true)}}setTimeout(function(){j.addEventListener("click",h,true);j.addEventListener("dblclick",i,true)},0)}return{decorate:b,define:f,limitInputWidth:e,toCssPx:d,swallowDoubleClick:c}});(function(){if("ontouchstart" in document.documentElement){document.addEventListener("touchstart",function(n){var j=document.body.querySelectorAll(".hover");for(var k=0;k<j.length;k++){j[k].classList.remove("hover")}findAncestor(n.target,function(e){if(e.classList){e.classList.add("hover")}return !e.classList})},true);try{var g=/:hover/;for(var d=0;d<document.styleSheets.length;d++){var h=document.styleSheets[d];for(var c=0;h.cssRules&&c<h.cssRules.length;c++){var l=h.cssRules[c];if(l.type===CSSRule.STYLE_RULE&&g.test(l.selectorText)){var m=l.selectorText.split(","),a=[];for(var b=0;b<m.length;b++){if(!g.test(m[b])){a.push(m[b])}}if(a.length===0){h.deleteRule(c)}else{l.selectorText=a.join(",")}}}}}catch(f){}}})();cr.define("cr.ui",function(){var a=null;function b(k,h,e){var c=$("notification");var d=c.querySelector(".link-color");var f=e||5000;function j(){window.clearTimeout(a);c.classList.add("show");document.body.classList.add("notification-shown")}function i(){window.clearTimeout(a);c.classList.remove("show");document.body.classList.remove("notification-shown");d.tabIndex=-1;d.blur()}function g(){a=window.setTimeout(i,f)}c.firstElementChild.textContent=k;d.textContent=h;d.onclick=i;d.onkeydown=function(l){if(l.keyIdentifier=="Enter"){i()}};c.onmouseover=j;c.onmouseout=g;d.onfocus=j;d.onblur=g;d.tabIndex=0;j();g()}return{showNotification:b}});cr.define("cr.model",function(){var i=new cr.BaseModel("file"),j=new cr.BaseModel("user"),d=new cr.BaseModel("disk"),f=new cr.BaseModel("regularfilmshow"),l=new cr.BaseModel("previewshowticket"),m=new cr.BaseModel("diskreview"),a=new cr.BaseModel("news"),e=new cr.BaseModel("document"),b=new cr.BaseModel("publication"),c=new cr.BaseModel("sponsor"),k=new cr.BaseModel("exco"),h=new cr.BaseModel("sitesettings"),g=new cr.BaseModel("onesentence");i.fields=["id","name","url"];j.fields=["id","expire_at","admin","full_name","itsc","member_type","pennalized","rfs_count","login_count"];d.fields=["id","director_en","director_ch","category","create_log","imdb_url","show_year","avail_type","actors","desc_en","tags","title_en","cover_url","disk_type","due_at","borrow_cnt","length","desc_ch","title_ch","user_held"];d.CN=function(n){return n.disk_type+pad(n.id,4)};f.fields=["id","state","film_1","film_2","film_3","vote_cnt_1","vote_cnt_2","vote_cnt_3","create_log"];l.fields=["id","state","title_en","title_ch","desc_en","desc_ch","director_en","director_ch","actors","cover_url","language","subtitle","venue","show_time","apply_deadline","length","quantity","remarks","successful_applicant","create_log"];m.fields=["id","disk","content","create_log"];a.fields=["id","title","content","create_log"];e.fields=["id","title","doc_url","create_log"];b.fields=["id","Type","title","cover_url","doc_url","create_log"];c.fields=["id","name","x","y","w","h","img_url"];k.fields=["id","name_en","name_ch","descript","position","email","img_url"];h.fields=["id","key","value"];h._cache_dict={};h.loadSettings=function(o){var n=new cr.APIRequest(this,"GET","/",true);n.onload=function(q){for(var p=0;p<q.recObj.objects.length;p++){h.update(q.recObj.objects[p],1);h._cache_dict[q.recObj.objects[p].key]=q.recObj.objects[p].id}if(o){o()}};n.onerror=cr.errorHandler;n.send()};h.getField=function(n){if(!this._cache_dict[n]){return null}return this._cache[this._cache_dict[n]].data};g.fields=["id","content","film"];return{File:i,User:j,Disk:d,RegularFilmShow:f,PreviewShowTicket:l,DiskReview:m,News:a,Document:e,Publication:b,Sponsor:c,Exco:k,SiteSettings:h,OneSentence:g}});cr.model.Disk.setup(true);cr.model.RegularFilmShow.setup(true);cr.model.PreviewShowTicket.setup(true);cr.model.News.setup(true);cr.model.Document.setup(true);cr.model.Publication.setup(true);cr.model.Sponsor.setup(true);cr.model.Exco.setup(true);cr.define("cr.ui",function(){function a(e,f){var d=$("content-wrapper");d.classList.add("loading");if(e instanceof HTMLElement||e instanceof DocumentFragment){setTimeout(function(){d.setAttribute("hidden",true);while(d.firstChild){d.removeChild(d.firstChild)}d.appendChild(e);d.removeAttribute("hidden");setTimeout(function(){d.classList.remove("loading")},0);if(f){f()}},cr.view.name?210:0)}else{if(e instanceof Function){setTimeout(function(){d.setAttribute("hidden",true);while(d.firstChild){d.removeChild(d.firstChild)}e(d);d.removeAttribute("hidden");setTimeout(function(){d.classList.remove("loading")},0);if(f){f()}},cr.view.name?210:0)}else{d.classList.remove("loading");assert(false,"Error processing content")}}}function c(e){var d=document.querySelector('#footer a[controls="'+e+'"]');b(d)}function b(d){var e=document.querySelector("#footer a.selected");if(e!==d){d.classList.add("selected");if(e){e.classList.remove("selected")}}}return{replaceContent:a,changeSelection:c,setSelection:b}});cr.define("cr.ui.select",function(){function a(b){b.value="";b.name=b.getAttribute("name");b.type="select";b.querySelector(".custom-options").addEventListener("click",function(c){if(c.target===this){return}b.querySelector(".default").textContent=c.target.textContent;b.value=c.target.getAttribute("value");this.setAttribute("hidden",true);setTimeout((function(){this.removeAttribute("hidden")}).bind(this),0)})}return{init:a}});cr.define("OneSentence",function(){function a(){var b=new cr.APIRequest(cr.model.OneSentence,"GET","/rand/",true);b.onload=function(d){var c=$("onesentence");c.querySelector("span").textContent=d.recObj.content;c.setAttribute("tooltip","From: "+cr.ui.template.escapeAttr(d.recObj.film))};b.onerror=function(c){};b.send()}return{Initialization:a}});document.addEventListener("DOMContentLoaded",OneSentence.Initialization);cr.define("Application",function(){var b={Full:"Full Member",OneSem:"One Semester Member",OneYear:"One Year Member",TwoYear:"Two Year Member",ThreeYear:"Three Year Member",Honour:"Honour Member",Assoc:"Asscocitate Member"};function e(){window.addEventListener("moduleload",function(){var g=new cr.APIRequest(cr.model.User,"GET","/current_user/",true);g.onload=function(h){cr.define("cr",function(){return{user:deepCopy(h.recObj)}});var i=cr.ui.template.render_template("user_panel.html",{user:h.recObj,table:b});i.querySelector(".link-logout").addEventListener("click",function(){var k=location.hash.substr(1),j=cr.settings.logout_url+(k?"?next="+k:"");location.href=j});i.querySelector(".link-admin").addEventListener("click",function(){window.open("admin/")});$("header").replaceChild(i,$("user-wrapper"));cr.ui.showNotification(h.recObj.full_name+", Welcome back!","dismiss");cr.model.SiteSettings.loadSettings(function(){cr.dispatchSimpleEvent(window,"authload",false,false)})};g.onerror=function(h){if(h.recObj.errno===2){$("user-wrapper").querySelector(".link-login").addEventListener("click",function(){var j=location.hash.substr(1),i=cr.settings.login_url+(j?"?next="+j:""),k="https://cas.ust.hk/cas/login?service="+encodeURIComponent(i);location.href=k});cr.model.SiteSettings.loadSettings(function(){cr.dispatchSimpleEvent(window,"authload",false,false)})}else{a(h)}};g.send()});window.addEventListener("authload",cr.ui.hideLoading);cr.define("cr",function(){return{errorHandler:a,notFoundHandler:f}});$("footer").addEventListener("click",function(h){var g=h.target.getAttribute("href").substr(1);routerManager.pushState(g,false,false);h.preventDefault();h.stopPropagation()},true)}function a(i){var h=i.recObj.errno,g=i.recObj.error||"Connection Failed";switch(h){case 0:case 1:case 2:case 3:cr.ui.showNotification(g,"dismiss");break;case 404:f();break;default:cr.ui.showNotification("Server: "+g,"try again later")}}function d(){var g=new Image()}function f(){var g=cr.ui.template.render_template("notfound.html");cr.view.name="404";cr.ui.replaceContent(g)}function c(j){var g=j.querySelectorAll("input:enabled, select:enabled, textarea:enabled, .input"),k={};for(var h=0;h<g.length;h++){k[g[h].name]=(g[h].type==="checkbox")?g[h].checked:g[h].value;if(k[g[h].name]==undefined||k[g[h].name]===""){k[g[h].name]=null;if(g[h].getAttribute("role")==="list"){k[g[h].name]=""}}}return k}return{initialization:e,startPage:d,collectForm:c}});document.addEventListener("DOMContentLoaded",Application.initialization);cr.ui.template.register("user_panel.html");cr.ui.template.register("notfound.html");cr.define("cr.view.library",function(){var a="library";function j(){routerManager.register(/library\//,false,c(b));routerManager.register(/library\/search\//,false,c(g));routerManager.register(/library\/(\d+)\//,false,c(h));routerManager.register(/library\/rand\//,false,c(f));cr.ui.template.register("liba_template.html",function(){var k=this;i(k);this.querySelector('button[controls="search"]').addEventListener("click",function(){var l=k.querySelector('input[name="search_term"]').value;if(l){routerManager.pushState("library/search/?q="+encodeURIComponent(l),false,true);e(k,g,[{q:l}])}});this.querySelector('button[controls="random"]').addEventListener("click",function(){routerManager.pushState("library/rand/",false,true);e(k,f)});this.querySelector('button[controls="popular"]').addEventListener("click",function(){routerManager.pushState("library/?mode=popular",false,true);e(k,b,[{mode:"popular"}])});this.querySelector('button[controls="rank"]').addEventListener("click",function(){routerManager.pushState("library/?mode=rank",false,true);e(k,b,[{mode:"rank"}])})});cr.ui.template.register("liba_suggest_item.html",function(l){var k=this.querySelector(".item-cover");if(l.disk.cover_url){k.style.backgroundImage="url("+cr.settings.resource_base+"upload/"+l.disk.cover_url.url+")"}else{k.style.backgroundImage="url("+cr.settings.resource_base+"css/question.png)"}});cr.ui.template.register("liba_list.html");cr.ui.template.register("liba_list_notfound.html",function(){this.querySelector(".link-goback").addEventListener("click",function(){if(history.length>1){history.go(-1)}else{routerManager.pushState("library/",false,true);e(document.querySelector(".library-wrapper"),b,[{}])}})});cr.ui.template.register("liba_list_item.html",function(m){var l=this.querySelector("div.disk-cover-border"),k=this.querySelector(".disk-detail-button");if(m.disk.cover_url){l.style.backgroundImage="url("+cr.settings.resource_base+"upload/"+m.disk.cover_url.url+")"}else{l.style.backgroundImage="url("+cr.settings.resource_base+"css/question.png)"}k.addEventListener("click",(function(n){routerManager.pushState("library/"+n+"/",false,true);e(document.querySelector(".library-wrapper"),h,[n])}).bind(null,m.disk.id))});cr.ui.template.register("liba_disk.html",function(){var k=this.querySelector(".popup-overlay");k.addEventListener("close",function(){this.classList.add("loading");setTimeout((function(){this.setAttribute("hidden",true)}).bind(this),210)});k.addEventListener("click",function(l){l.target===this&&cr.dispatchSimpleEvent(this,"close",true,true)});k.addEventListener("keydown",function(l){if(l.keyCode===27){cr.dispatchSimpleEvent(this,"close",true,true)}});k.querySelector(".close-button").addEventListener("click",function(){cr.dispatchSimpleEvent(k,"close",true,true)})});cr.ui.template.register("liba_disk_detail.html",function(r){var p=this.querySelector(".disk-brief .disk-cover");if(r.disk.cover_url){p.style.backgroundImage="url("+cr.settings.resource_base+"upload/"+r.disk.cover_url.url+")"}else{p.style.backgroundImage="url("+cr.settings.resource_base+"css/question.png)"}this.querySelector(".link-goback").addEventListener("click",function(){if(history.length>1){history.go(-1)}else{routerManager.pushState("library/",false,true);e(document.querySelector(".library-wrapper"),b,[{}])}});var n=this.querySelector(".actors-wrapper");for(var m=0;m<r.disk.actors.length;m++){var l=createElementWithClassName("span","link link-search");l.setAttribute("tag","actor");l.textContent=r.disk.actors[m];(m>0)&&n.appendChild(createElementWithClassName("span","space"));n.appendChild(l)}var o=this.querySelector(".tags-wrapper");for(var m=0;m<r.disk.tags.length;m++){var k=createElementWithClassName("span","link link-search");k.setAttribute("tag","tag");k.textContent=r.disk.tags[m];(m>0)&&o.appendChild(createElementWithClassName("span","space"));o.appendChild(k)}var q=this.querySelectorAll(".link-search");for(var m=0;m<q.length;m++){q[m].addEventListener("click",function(u){var s=this.getAttribute("tag"),t=s+":("+this.textContent+")";routerManager.pushState("library/search/?q="+encodeURIComponent(t),false,true);e(document.querySelector(".library-wrapper"),g,[{q:t}])})}this.querySelector('button[controls="reserve"]').addEventListener("click",function(){var s=document.querySelector(".library-wrapper .library-disk .popup-overlay"),v=s.querySelector(".popup-box"),u=v.querySelector(".content"),t=cr.ui.template.render_template("liba_disk_reserve.html",{disk:r.disk});v.querySelector("h1").textContent="Reserve Disk";while(u.firstChild){u.removeChild(u.firstChild)}u.appendChild(t);v.classList.remove("loading");s.removeAttribute("hidden");setTimeout(function(){s.classList.remove("loading")},0)});this.querySelector('button[controls="renew"]').addEventListener("click",function(){var s=document.querySelector(".library-wrapper .library-disk .popup-overlay"),v=s.querySelector(".popup-box"),u=v.querySelector(".content"),t=cr.ui.template.render_template("liba_disk_renew.html",{disk:r.disk});v.querySelector("h1").textContent="Renew Disk";while(u.firstChild){u.removeChild(u.firstChild)}u.appendChild(t);v.classList.remove("loading");s.removeAttribute("hidden");setTimeout(function(){s.classList.remove("loading")},0)})});cr.ui.template.register("liba_disk_reserve.html",function(n){var m=this,l=this.querySelectorAll(".custom-select");for(var k=0;k<l.length;k++){cr.ui.select.init(l[k])}this.querySelector('button[controls="deliver"]').addEventListener("click",function(){var p=Application.collectForm(m.querySelector(".reserve-delivery")),o=new cr.APIRequest(cr.model.Disk,"POST","/"+n.disk.id+"/reservation/");p.form="Hall";p.hall=~~(p.hall);o.onload=function(r){var q=r.recObj;cr.model.Disk.update(q,1);cr.ui.showNotification("Disk reserved","dismiss");history.go()};o.onerror=function(q){m.classList.remove("loading");cr.errorHandler(q)};m.classList.add("loading");o.sendJSON(p)});this.querySelector('button[controls="reserve"]').addEventListener("click",function(){var o=new cr.APIRequest(cr.model.Disk,"POST","/"+n.disk.id+"/reservation/"),p={form:"Counter"};o.onload=function(r){var q=r.recObj;cr.model.Disk.update(q,2);cr.ui.showNotification("Disk reserved","dismiss");history.go()};o.onerror=function(q){m.classList.remove("loading");cr.errorHandler(q)};m.classList.add("loading");o.sendJSON(p)})});cr.ui.template.register("liba_disk_renew.html",function(l){var k=this;this.querySelector('button[controls="renew"]').addEventListener("click",function(){var m=new cr.APIRequest(cr.model.Disk,"POST","/"+l.disk.id+"/borrow/"),n={id:cr.user&&cr.user.id};m.onload=function(p){var o=p.recObj;cr.model.Disk.update(o,2);cr.ui.showNotification("Disk renewed","dismiss");history.go()};m.onerror=function(o){k.classList.remove("loading");cr.errorHandler(o)};k.classList.add("loading");m.sendJSON(n)})});cr.ui.template.register("disk_review_entry.html")}function c(k){return function(){if(cr.view.name!==a){var l=cr.ui.template.render_template("liba_template.html");cr.ui.replaceContent(l,(function(m){cr.ui.changeSelection(a);cr.view.name=a;k.apply(this,m)}).bind(l,arguments))}else{e(document.querySelector(".library-wrapper"),k,arguments)}}}function e(l,m,n){var k=l.querySelector(".right-panel");k.classList.add("loading");setTimeout(function(){k.setAttribute("hidden",true);while(k.firstChild){k.removeChild(k.firstChild)}m.apply(l,n)},210)}function d(o,l,n){var r=0,m=o.querySelector(".list-item-wrapper");l.load(q);o.querySelector(".prev-button").addEventListener("click",function(){r--;routerManager.pushState(n(r),false,true);o.classList.add("loading");l.prev(k)});o.querySelector(".next-button").addEventListener("click",function(){r++;routerManager.pushState(n(r),false,true);o.classList.add("loading");l.next(q)});function k(s){p.call(this,s,"prev")}function q(s){p.call(this,s,"next")}function p(u,x){var w=m.querySelectorAll(".list-item"),s=m.querySelectorAll(".library-notfound");for(var t=0;t<w.length;t++){w[t].classList.add(x=="next"?"at_left":"at_right")}for(var t=0;t<s.length;t++){s[t].classList.add("loading")}if(u.length===0){var y=cr.ui.template.render_template("liba_list_notfound.html");m.appendChild(y);o.querySelector(".prev-button").setAttribute("hidden",true);o.querySelector(".next-button").setAttribute("hidden",true);setTimeout(function(){y.classList.remove("loading")},0)}else{if(this.has_prev){o.querySelector(".prev-button").removeAttribute("hidden")}else{o.querySelector(".prev-button").setAttribute("hidden",true)}if(this.has_next){o.querySelector(".next-button").removeAttribute("hidden")}else{o.querySelector(".next-button").setAttribute("hidden",true)}for(var t=0;t<u.length;t++){var v=cr.ui.template.render_template("liba_list_item.html",{disk:u[t]});v.classList.add(x=="next"?"at_right":"at_left");v.classList.add("item-"+t);m.appendChild(v);setTimeout((function(){this.classList.remove(x=="next"?"at_right":"at_left")}).bind(v),0)}}o.classList.remove("loading");setTimeout(function(){for(var z=0;z<w.length;z++){m.removeChild(w[z])}for(var z=0;z<s.length;z++){m.removeChild(s[z])}},410)}}function b(r){var q=r.mode||"",o=r.page||1,p=cr.ui.template.render_template("liba_list.html"),l=this.querySelector(".right-panel"),k=new cr.Pager(cr.model.Disk,m(q,o));l.appendChild(p);l.removeAttribute("hidden");l.classList.remove("loading");switch(q){case"popular":document.title="Top Popular | Film Society, HKUSTSU";break;case"rank":document.title="Top Ranked | Film Society, HKUSTSU";break;default:document.title="VCD/DVD Library | Film Society, HKUSTSU"}var n=function(v){var t=[],s=~~(o)+~~(v),u="library/";if(s!==1){t.push("page="+encodeURIComponent(s))}switch(q){case"popular":case"rank":t.push("mode="+encodeURIComponent(q))}return u+((t.length!==0)?("?"+t.join("&")):"")};d(p,k,n);function m(u,t){var s="/?limit=6&page="+encodeURIComponent(t);switch(u){case"popular":s+="&ordering=-borrow_cnt,-id";break;case"rank":s+="&ordering=-rank,-id"}return s}}function g(l){var s=l.q||"",q=l.page||1,n=cr.ui.template.render_template("liba_list.html"),k=this.querySelector(".right-panel"),o=this.querySelector('.left-panel .library-search input[name="search_term"]'),m=new cr.Pager(cr.model.Disk,r(s,q));o.value=s;k.appendChild(n);k.removeAttribute("hidden");k.classList.remove("loading");document.title="Searching For "+s+" | Film Society, HKUSTSU";var p=function(w){var u=[],t=~~(q)+~~(w),v="library/search/";u.push("q="+encodeURIComponent(s));if(t!==1){u.push("page="+encodeURIComponent(t))}return v+((u.length!==0)?("?"+u.join("&")):"")};d(n,m,p);function r(v,u){var t="/search/?limit=6&page="+encodeURIComponent(u);t+="&query="+encodeURIComponent(v);return t}}function i(s){var p=s.querySelector('.left-panel input[name="search_term"]'),t=s.querySelector(".left-panel .search-suggestion"),m=0,w=0,l=[],k=0;p.addEventListener("keypress",function(x){if(x.keyCode>=46||x.keyCode<=9){r(this.value,t)}});p.addEventListener("keyup",function(x){if(x.keyCode>=46||x.keyCode<=9){r(this.value,t)}});p.addEventListener("focus",function(){v(p);r(this.value,t)});p.addEventListener("blur",function(){u(t);q(p)});function o(x){switch(x.keyCode){case 13:if(m!==0){var y=l[m-1];this.value="";this.blur();routerManager.pushState("library/"+y+"/",false,true);e(document.querySelector(".library-wrapper"),h,[y])}else{this.blur();routerManager.pushState("library/search/?q="+encodeURIComponent(this.value),false,true);e(document.querySelector(".library-wrapper"),g,[{q:this.value}])}break;case 27:this.blur();break;case 38:x.preventDefault();m=(m+w)%(w+1);n(m);break;case 40:x.preventDefault();m=(m+w+2)%(w+1);n(m);break}}function v(x){x.addEventListener("keydown",o,true);k=1}function q(x){k=0;x.removeEventListener("keydown",o)}function n(x){var z=t.querySelector(".selected"),y=t.querySelector(".suggest-item:nth-of-type("+x+")");if(z===y){return}z&&z.classList.remove("selected");y&&y.classList.add("selected")}function r(z,y){if(z===""||/[:()]/.test(z)){return u(y)}var x=new cr.APIRequest(cr.model.Disk,"GET","/search/?limit=5&engine=defualt&query="+encodeURIComponent(z));x.onload=function(D){if(p.value!==z||k===0){return}var C=D.recObj.objects;u(y);w=C.length;y.removeAttribute("hidden");for(var A=0;A<C.length;A++){cr.model.Disk.update(C[A],1);var B=cr.ui.template.render_template("liba_suggest_item.html",{disk:C[A]});y.appendChild(B);B.addEventListener("mouseover",(function(E){if(m===E){return}m=E;n(E)}).bind(B,A+1));B.addEventListener("mousedown",(function(E){p.value="";p.blur();routerManager.pushState("library/"+E+"/",false,true);e(document.querySelector(".library-wrapper"),h,[E])}).bind(null,C[A].id));l.push(C[A].id);setTimeout((function(){this.classList.remove("loading")}).bind(B),A*50)}};x.send()}function u(x){x.setAttribute("hidden",true);while(x.firstChild){x.removeChild(x.firstChild)}m=0;w=0;l=[]}}function h(m){var l=cr.ui.template.render_template("liba_disk.html",{user:cr.user}),k=this.querySelector(".right-panel");k.appendChild(l);k.removeAttribute("hidden");k.classList.remove("loading");cr.model.Disk.get(m,function(p){var q=cr.ui.template.render_template("liba_disk_detail.html",{disk:p,cn:cr.model.Disk.CN(p),user:cr.user}),x=l.querySelector(".diskreview-wrapper");l.querySelector(".disk-wrapper").appendChild(q);setTimeout(function(){l.classList.remove("loading")},0);document.title=p.title_en+" "+p.title_ch+" | Film Society, HKUTSU";var n=new cr.APIRequest(cr.model.Disk,"GET","/"+m+"/rate/");n.onload=function(F){var C=F.recObj,B=l.querySelector(".rate-box .rate-num"),E=l.querySelector(".rate-box .rate-up-button"),r=l.querySelector(".rate-box .rate-down-button");B.textContent=C.ups-C.downs;if(C.ups>C.downs){B.classList.add("positive")}else{if(C.ups<C.downs){B.classList.add("negative")}}if(C.rated){E.setAttribute("tooltip","You have rated before");r.setAttribute("tooltip","You have rated before")}else{E.addEventListener("click",function(){D("up")});r.addEventListener("click",function(){D("down")})}l.querySelector(".rate-box").classList.remove("loading");function D(H){var G=new cr.APIRequest(cr.model.Disk,"POST","/"+m+"/rate/");G.onload=function(J){var I=J.recObj;if(!B){return}B.textContent=I.ups-I.downs;if(I.ups>I.downs){B.classList.add("positive")}else{if(I.ups<I.downs){B.classList.add("negative")}}if(I.rated){E.setAttribute("tooltip","You have rated before");r.setAttribute("tooltip","You have rated before")}cr.ui.showNotification("Rate successful","dismiss")};G.onerror=function(){cr.ui.showNotification("Rate failed","dismiss")};G.sendJSON({rate:H})}};n.send();var s=new cr.Pager(cr.model.DiskReview,"/?disk="+m),A=true,o=true,w=false,z=l.querySelector(".diskreview-wrapper"),t=z.querySelector(".diskreview-inner-wrapper"),u=t.querySelector(".anchor");s.load(v);function v(C){if(A){A=false;if(C.length===0){w=true;if(w){u.textContent="Be the first one to comment"}}var B=z.querySelector('.diskreview-input-box button[controls="submit"]');B.addEventListener("click",function(){var E=z.querySelector('.diskreview-input-box textarea[name="review"]');if(!E.value){return}var F={disk:m,content:E.value};cr.model.DiskReview.post(F,function(H){var I=t.querySelector(".diskreview-title").nextSibling,G=cr.ui.template.render_template("disk_review_entry.html",{review:H});t.insertBefore(G,I);if(w){t.removeChild(u);w=false}setTimeout(function(){G.classList.remove("loading")},0)})})}for(var r=0;r<C.length;r++){var D=cr.ui.template.render_template("disk_review_entry.html",{review:C[r]});t.insertBefore(D,u);setTimeout((function(){this.classList.remove("loading")}).bind(D),50*r)}if(!this.has_next&&!w){t.removeChild(u);z.querySelector(".diskreview-entry-wrapper").removeEventListener("scroll",y)}o=false}function y(C){if(o){return}C.preventDefault();C.stopImmediatePropagation();var B=z.scrollTop,D=z.clientHeight,r=z.scrollHeight;if(B+D+5>r){o=true;pager.next(v)}}})}function f(){var l=new cr.APIRequest(cr.model.Disk,"GET","/rand/",true),k=this;l.onload=function(m){cr.model.Disk.update(m.recObj,1);h.call(k,m.recObj.id)};l.onerror=cr.errorHandler;l.send()}return{Initialization:j}});cr.view.library.Initialization();